# 订单API文档

本文档详细介绍商城系统中与订单相关的所有API，包括创建、查询、支付、发货等操作。

## 1. 创建订单

### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/orders`
- 权限：已登录用户
- 请求体：

```json
{
  "storeId": 1,
  "addressId": 1,
  "paymentType": "支付宝",
  "items": [
    {
      "productId": 1,
      "quantity": 2,
      "specInfo": "颜色:红色;尺寸:L"
    }
  ],
  "remark": "请尽快发货"
}
```

### 响应

```json
{
  "code": 200,
  "msg": "订单创建成功",
  "data": {
    "id": 1,
    "orderNo": "202304070001000001",
    "userId": 1,
    "storeId": 1,
    "items": "[{\"productId\":1,\"productName\":\"商品名称\",\"price\":100.00,\"quantity\":2,\"specInfo\":\"颜色:红色;尺寸:L\",\"totalPrice\":200.00}]",
    "totalAmount": 200.00,
    "addressInfo": "{\"id\":1,\"name\":\"张三\",\"phone\":\"13800138000\",\"address\":\"北京市朝阳区xxx\"}",
    "paymentType": "支付宝",
    "status": 0,
    "refundStatus": 0,
    "createTime": "2023-04-07T10:00:00",
    "updateTime": "2023-04-07T10:00:00"
  }
}
```

### 测试用例

- **用例1**：正常创建订单
  - 请求：`POST http://localhost:8080/api/orders`
    ```json
    {
      "storeId": 1,
      "addressId": 1,
      "paymentType": "支付宝",
      "items": [
        {
          "productId": 1,
          "quantity": 2,
          "specInfo": "颜色:红色;尺寸:L"
        }
      ]
    }
    ```
  - 预期结果：订单创建成功，返回订单信息

- **用例2**：商品库存不足
  - 请求：`POST http://localhost:8080/api/orders`
    ```json
    {
      "storeId": 1,
      "addressId": 1,
      "paymentType": "支付宝",
      "items": [
        {
          "productId": 1,
          "quantity": 999,
          "specInfo": "颜色:红色;尺寸:L"
        }
      ]
    }
    ```
  - 预期结果：返回错误信息，提示库存不足

- **用例3**：商品已下架
  - 请求：`POST http://localhost:8080/api/orders`
    ```json
    {
      "storeId": 1,
      "addressId": 1,
      "paymentType": "支付宝",
      "items": [
        {
          "productId": 2,
          "quantity": 1,
          "specInfo": "颜色:红色;尺寸:L"
        }
      ]
    }
    ```
  - 预期结果：返回错误信息，提示商品已下架

## 2. 获取订单列表

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "orderNo": "202304070001000001",
      "userId": 1,
      "storeId": 1,
      "items": "[{\"productId\":1,\"productName\":\"商品名称\",\"price\":100.00,\"quantity\":2,\"specInfo\":\"颜色:红色;尺寸:L\",\"totalPrice\":200.00}]",
      "totalAmount": 200.00,
      "addressInfo": "{\"id\":1,\"name\":\"张三\",\"phone\":\"13800138000\",\"address\":\"北京市朝阳区xxx\"}",
      "paymentType": "支付宝",
      "status": 0,
      "refundStatus": 0,
      "createTime": "2023-04-07T10:00:00",
      "updateTime": "2023-04-07T10:00:00"
    }
  ]
}
```

### 测试用例

- **用例1**：获取用户所有订单
  - 请求：`GET http://localhost:8080/api/orders`
  - 预期结果：返回用户的所有订单列表

## 3. 获取订单详情

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/{id}`
- 权限：已登录用户
- 参数：
  - `id`：订单ID，路径参数

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "orderNo": "202304070001000001",
    "userId": 1,
    "storeId": 1,
    "items": "[{\"productId\":1,\"productName\":\"商品名称\",\"price\":100.00,\"quantity\":2,\"specInfo\":\"颜色:红色;尺寸:L\",\"totalPrice\":200.00}]",
    "totalAmount": 200.00,
    "addressInfo": "{\"id\":1,\"name\":\"张三\",\"phone\":\"13800138000\",\"address\":\"北京市朝阳区xxx\"}",
    "paymentType": "支付宝",
    "status": 0,
    "refundStatus": 0,
    "createTime": "2023-04-07T10:00:00",
    "updateTime": "2023-04-07T10:00:00"
  }
}
```

### 测试用例

- **用例1**：获取存在的订单
  - 请求：`GET http://localhost:8080/api/orders/1`
  - 预期结果：返回订单详细信息

- **用例2**：获取不存在的订单
  - 请求：`GET http://localhost:8080/api/orders/999`
  - 预期结果：返回错误信息，提示订单不存在

## 4. 取消订单

### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/orders/{id}/cancel`
- 权限：已登录用户
- 参数：
  - `id`：订单ID，路径参数

### 响应

```json
{
  "code": 200,
  "msg": "订单取消成功",
  "data": true
}
```

### 测试用例

- **用例1**：取消待付款订单
  - 请求：`POST http://localhost:8080/api/orders/1/cancel`
  - 预期结果：订单取消成功，返回true

- **用例2**：取消已付款订单
  - 请求：`POST http://localhost:8080/api/orders/2/cancel`
  - 预期结果：返回错误信息，提示只能取消待付款订单

## 5. 支付订单

### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/orders/{id}/pay`
- 权限：已登录用户
- 参数：
  - `id`：订单ID，路径参数
- 请求体：
```json
{
  "paymentType": "支付宝"
}
```

### 响应

```json
{
  "code": 200,
  "msg": "支付成功",
  "data": true
}
```

### 测试用例

- **用例1**：支付待付款订单
  - 请求：`POST http://localhost:8080/api/orders/1/pay`
    ```json
    {
      "paymentType": "支付宝"
    }
    ```
  - 预期结果：支付成功，返回true

- **用例2**：支付已支付订单
  - 请求：`POST http://localhost:8080/api/orders/2/pay`
    ```json
    {
      "paymentType": "支付宝"
    }
    ```
  - 预期结果：返回错误信息，提示订单状态错误

## 6. 确认收货

### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/orders/{id}/receive`
- 权限：已登录用户
- 参数：
  - `id`：订单ID，路径参数

### 响应

```json
{
  "code": 200,
  "msg": "确认收货成功",
  "data": true
}
```

### 测试用例

- **用例1**：确认待收货订单
  - 请求：`POST http://localhost:8080/api/orders/1/receive`
  - 预期结果：确认收货成功，返回true

- **用例2**：确认未发货订单
  - 请求：`POST http://localhost:8080/api/orders/2/receive`
  - 预期结果：返回错误信息，提示订单状态错误

## 7. 申请退款

### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/orders/{id}/refund`
- 权限：已登录用户
- 参数：
  - `id`：订单ID，路径参数
- 请求体：
```json
{
  "reason": "商品质量问题"
}
```

### 响应

```json
{
  "code": 200,
  "msg": "申请退款成功",
  "data": true
}
```

### 测试用例

- **用例1**：申请退款（待发货状态）
  - 请求：`POST http://localhost:8080/api/orders/1/refund`
    ```json
    {
      "reason": "商品质量问题"
    }
    ```
  - 预期结果：申请退款成功，返回true

- **用例2**：申请退款（已完成状态）
  - 请求：`POST http://localhost:8080/api/orders/2/refund`
    ```json
    {
      "reason": "商品质量问题"
    }
    ```
  - 预期结果：返回错误信息，提示当前订单状态不支持申请退款

## 8. 获取各状态订单数量

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/count`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "pendingPayment": 1,
    "pendingShipment": 2,
    "pendingReceipt": 1,
    "completed": 5,
    "pendingReview": 3
  }
}
```

### 测试用例

- **用例1**：获取订单数量统计
  - 请求：`GET http://localhost:8080/api/orders/count`
  - 预期结果：返回各状态订单数量

## 9. 获取待付款订单

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/pending-payment`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "orderNo": "202304070001000001",
      "totalAmount": 200.00,
      "status": 0,
      "createTime": "2023-04-07T10:00:00"
    }
  ]
}
```

### 测试用例

- **用例1**：获取待付款订单列表
  - 请求：`GET http://localhost:8080/api/orders/pending-payment`
  - 预期结果：返回待付款订单列表

## 10. 获取待发货订单

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/pending-shipment`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 2,
      "orderNo": "202304070001000002",
      "totalAmount": 300.00,
      "status": 1,
      "paymentTime": "2023-04-07T11:00:00",
      "createTime": "2023-04-07T10:00:00"
    }
  ]
}
```

### 测试用例

- **用例1**：获取待发货订单列表
  - 请求：`GET http://localhost:8080/api/orders/pending-shipment`
  - 预期结果：返回待发货订单列表

## 11. 获取待收货订单

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/pending-receipt`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 3,
      "orderNo": "202304070001000003",
      "totalAmount": 400.00,
      "status": 2,
      "paymentTime": "2023-04-07T11:00:00",
      "shippingTime": "2023-04-07T14:00:00",
      "createTime": "2023-04-07T10:00:00"
    }
  ]
}
```

### 测试用例

- **用例1**：获取待收货订单列表
  - 请求：`GET http://localhost:8080/api/orders/pending-receipt`
  - 预期结果：返回待收货订单列表

## 12. 获取待评价订单

### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/orders/pending-review`
- 权限：已登录用户

### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 4,
      "orderNo": "202304070001000004",
      "totalAmount": 500.00,
      "status": 3,
      "paymentTime": "2023-04-07T11:00:00",
      "shippingTime": "2023-04-07T14:00:00",
      "createTime": "2023-04-07T10:00:00"
    }
  ]
}
```

### 测试用例

- **用例1**：获取待评价订单列表
  - 请求：`GET http://localhost:8080/api/orders/pending-review`
  - 预期结果：返回待评价订单列表

## 订单状态说明

- 0：待付款
- 1：待发货
- 2：待收货
- 3：已完成
- 4：已取消
- 5：已退款

## 退款状态说明

- 0：无退款
- 1：申请退款
- 2：退款成功
- 3：退款失败
