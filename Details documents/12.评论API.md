# 评论API文档

本文档详细介绍商城系统中与评论相关的所有API，包括发布、查询、回复、审核等操作。

### 1. 发布评论

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/reviews`
- 权限：普通用户
- 请求体：

```json
{
    "productId": 1,        // 必填，商品ID
    "orderId": 1,         // 必填，订单ID
    "content": "商品很好", // 必填，评论内容
    "rating": 5,          // 必填，评分(1-5星)
    "images": [           // 选填，评论图片
        "image1.jpg",
        "image2.jpg"
    ]
}
```

#### 响应

```json
{
    "code": 200,
    "msg": "评论发布成功",
    "data": {
        "id": 1,
        "productId": 1,
        "userId": 1,
        "orderId": 1,
        "content": "商品很好",
        "rating": 5,
        "images": "[\"image1.jpg\",\"image2.jpg\"]",
        "reply": null,
        "status": 0,
        "isTop": false,
        "createTime": "2024-04-03T12:00:00",
        "updateTime": "2024-04-03T12:00:00"
    }
}
```

#### 测试用例

- **用例1**：用户发布评论
  - 请求：`POST http://localhost:8080/api/reviews`（使用用户token）
    ```json
    {
        "productId": 1,
        "orderId": 1,
        "content": "商品质量非常好，物流很快！",
        "rating": 5,
        "images": ["image1.jpg", "image2.jpg"]
    }
    ```
  - 预期结果：评论发布成功，返回评论信息

- **用例2**：发布评论缺少必要信息
  - 请求：`POST http://localhost:8080/api/reviews`（使用用户token）
    ```json
    {
        "productId": 1,
        "content": "好评"
    }
    ```
  - 预期结果：返回错误信息，提示缺少必要字段

### 2. 获取商品评论列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews/product/{productId}`
- 权限：所有用户
- 参数：
  - `productId`：商品ID，路径参数

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "productId": 1,
            "userId": 1,
            "orderId": 1,
            "content": "商品很好",
            "rating": 5,
            "images": "[\"image1.jpg\",\"image2.jpg\"]",
            "reply": "感谢您的购买与支持",
            "status": 1,
            "isTop": true,
            "createTime": "2024-04-03T12:00:00",
            "updateTime": "2024-04-03T13:00:00"
        }
        // 更多评论...
    ]
}
```

#### 测试用例

- **用例1**：获取商品评论
  - 请求：`GET http://localhost:8080/api/reviews/product/1`
  - 预期结果：返回商品ID为1的所有已审核评论

### 3. 获取用户评论列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews/user/{userId}`
- 权限：所有用户
- 参数：
  - `userId`：用户ID，路径参数

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "productId": 1,
            "userId": 1,
            "orderId": 1,
            "content": "商品很好",
            "rating": 5,
            "images": "[\"image1.jpg\",\"image2.jpg\"]",
            "reply": "感谢您的购买与支持",
            "status": 1,
            "isTop": false,
            "createTime": "2024-04-03T12:00:00",
            "updateTime": "2024-04-03T13:00:00"
        }
        // 更多评论...
    ]
}
```

### 4. 获取订单评论

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews/order/{orderId}`
- 权限：已登录用户
- 参数：
  - `orderId`：订单ID，路径参数

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "productId": 1,
            "userId": 1,
            "orderId": 1,
            "content": "商品很好",
            "rating": 5,
            "images": "[\"image1.jpg\",\"image2.jpg\"]",
            "reply": null,
            "status": 1,
            "isTop": false,
            "createTime": "2024-04-03T12:00:00",
            "updateTime": "2024-04-03T12:00:00"
        }
    ]
}
```

### 5. 分页查询评论

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews`
- 权限：所有用户
- 参数：
  - `pageNum`：页码，默认为1，查询参数
  - `pageSize`：每页大小，默认为10，查询参数

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "list": [
            {
                "id": 1,
                "productId": 1,
                "userId": 1,
                "orderId": 1,
                "content": "商品很好",
                "rating": 5,
                "images": "[\"image1.jpg\",\"image2.jpg\"]",
                "reply": null,
                "status": 1,
                "isTop": false,
                "createTime": "2024-04-03T12:00:00",
                "updateTime": "2024-04-03T12:00:00"
            }
            // 更多评论...
        ],
        "pageNum": 1,
        "pageSize": 10
    }
}
```

### 6. 商家回复评论

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/reviews/{id}/reply`
- 权限：商家
- 参数：
  - `id`：评论ID，路径参数
  - `reply`：回复内容，查询参数

#### 响应

```json
{
    "code": 200,
    "msg": "回复成功",
    "data": true
}
```

#### 测试用例

- **用例1**：商家回复评论
  - 请求：`PUT http://localhost:8080/api/reviews/1/reply?reply=感谢您的购买与支持`（使用商家token）
  - 预期结果：回复成功，返回true

- **用例2**：非商家回复评论
  - 请求：`PUT http://localhost:8080/api/reviews/1/reply?reply=测试回复`（使用普通用户token）
  - 预期结果：返回403错误，提示无权限

### 7. 管理员审核评论

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/reviews/{id}/audit`
- 权限：管理员
- 参数：
  - `id`：评论ID，路径参数
  - `status`：状态(1-显示, 2-隐藏)，查询参数

#### 响应

```json
{
    "code": 200,
    "msg": "审核成功",
    "data": true
}
```

### 8. 管理员设置评论置顶

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/reviews/{id}/top`
- 权限：管理员
- 参数：
  - `id`：评论ID，路径参数
  - `isTop`：是否置顶，查询参数

#### 响应

```json
{
    "code": 200,
    "msg": "评论已置顶",
    "data": true
}
```

### 9. 删除评论

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/reviews/{id}`
- 权限：管理员
- 参数：
  - `id`：评论ID，路径参数

#### 响应

```json
{
    "code": 200,
    "msg": "评论删除成功",
    "data": true
}
```

### 10. 获取待审核评论列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews/pending`
- 权限：管理员

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": [
        {
            "id": 1,
            "productId": 1,
            "userId": 1,
            "orderId": 1,
            "content": "商品很好",
            "rating": 5,
            "images": "[\"image1.jpg\",\"image2.jpg\"]",
            "reply": null,
            "status": 0,
            "isTop": false,
            "createTime": "2024-04-03T12:00:00",
            "updateTime": "2024-04-03T12:00:00"
        }
        // 更多待审核评论...
    ]
}
```

### 11. 获取商品评论统计

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/reviews/product/{productId}/stats`
- 权限：所有用户
- 参数：
  - `productId`：商品ID，路径参数

#### 响应

```json
{
    "code": 200,
    "msg": "操作成功",
    "data": {
        "count": 10,           // 评论总数
        "averageRating": 4.5   // 平均评分
    }
}
```

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/reviews`
- 管理员账号: admin/password
- 商家账号: merchant/password
- 普通用户账号: user/password 