# 文件上传API文档

本文档详细介绍商城系统中与文件上传相关的所有API，包括图片上传、文档上传和文件删除等操作。

## 通用说明

### 文件大小限制
- 单个文件最大大小：10MB
- 单次请求最大大小：20MB

### 支持的图片格式
- JPEG (image/jpeg)
- PNG (image/png)
- GIF (image/gif)
- WebP (image/webp)

### 支持的文档格式
- PDF (application/pdf)
- JPEG (image/jpeg)
- PNG (image/png)

### 1. 上传商品图片

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/products`
- 权限：商家或管理员
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：图片文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "图片上传成功",
  "data": "http://localhost:8080/uploads/products/abc123.jpg"
}
```

#### 测试用例

- **用例1**：商家上传商品图片
  - 请求：`POST http://localhost:8080/api/files/products`（使用商家token）
  - 文件：选择一张JPG格式的图片
  - 预期结果：返回图片访问URL

- **用例2**：上传非图片文件
  - 请求：`POST http://localhost:8080/api/files/products`（使用商家token）
  - 文件：选择一个PDF文件
  - 预期结果：返回错误信息，提示不支持的文件格式

- **用例3**：非商家尝试上传商品图片
  - 请求：`POST http://localhost:8080/api/files/products`（使用普通用户token）
  - 文件：选择一张图片
  - 预期结果：返回403错误，提示无权限

### 2. 上传用户头像

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/avatars`
- 权限：无需登录
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：图片文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "头像上传成功",
  "data": "http://localhost:8080/uploads/avatars/def456.jpg"
}
```

#### 测试用例

- **用例1**：用户上传头像（无需登录）
  - 请求：`POST http://localhost:8080/api/files/avatars`
  - 文件：选择一张头像图片
  - 预期结果：返回头像访问URL

- **用例2**：上传超大图片
  - 请求：`POST http://localhost:8080/api/files/avatars`
  - 文件：选择一个超过10MB的图片
  - 预期结果：返回错误信息，提示文件大小超限

### 3. 上传店铺logo

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/stores/logos`
- 权限：商家
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：图片文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "店铺logo上传成功",
  "data": "http://localhost:8080/uploads/stores/logos/ghi789.jpg"
}
```

#### 测试用例

- **用例1**：商家上传店铺logo
  - 请求：`POST http://localhost:8080/api/files/stores/logos`（使用商家token）
  - 文件：选择一张logo图片
  - 预期结果：返回logo访问URL

### 4. 上传营业执照

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/stores/licenses`
- 权限：商家
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：文档文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "营业执照上传成功",
  "data": "http://localhost:8080/uploads/stores/licenses/jkl012.pdf"
}
```

#### 测试用例

- **用例1**：商家上传营业执照
  - 请求：`POST http://localhost:8080/api/files/stores/licenses`（使用商家token）
  - 文件：选择一个PDF文件
  - 预期结果：返回营业执照访问URL

### 5. 上传评价图片

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/reviews`
- 权限：普通用户
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：图片文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "评价图片上传成功",
  "data": "http://localhost:8080/uploads/reviews/mno345.jpg"
}
```

#### 测试用例

- **用例1**：用户上传评价图片
  - 请求：`POST http://localhost:8080/api/files/reviews`（使用用户token）
  - 文件：选择一张商品评价图片
  - 预期结果：返回图片访问URL

### 6. 上传客服消息文件

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/files/customer-service`
- 权限：已登录用户
- Content-Type：`multipart/form-data`
- 参数：
  - `file`：文件，必填

#### 响应

```json
{
  "code": 200,
  "msg": "文件上传成功",
  "data": "http://localhost:8080/uploads/customer-service/pqr678.doc"
}
```

#### 测试用例

- **用例1**：用户上传客服消息文件
  - 请求：`POST http://localhost:8080/api/files/customer-service`（使用用户token）
  - 文件：选择一个文件
  - 预期结果：返回文件访问URL

### 7. 删除文件

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/files`
- 权限：已登录用户
- 参数：
  - `fileUrl`：文件URL，必填，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "文件删除成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除存在的文件
  - 请求：`DELETE http://localhost:8080/api/files?fileUrl=http://localhost:8080/uploads/products/abc123.jpg`（使用用户token）
  - 预期结果：返回删除成功

- **用例2**：删除不存在的文件
  - 请求：`DELETE http://localhost:8080/api/files?fileUrl=http://localhost:8080/uploads/products/notexist.jpg`（使用用户token）
  - 预期结果：返回false

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误（如文件格式不支持、文件为空等）
- 401: 未认证或token过期
- 403: 无权操作
- 413: 文件大小超出限制
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/files`
- 商家账号: merchant/password
- 普通用户账号: user/password 