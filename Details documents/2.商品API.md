# 商品API文档

本文档详细介绍商城系统中与商品相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取所有商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "iPhone 13",
      "storeId": 1,
      "categoryId": 3,
      "price": 5999.00,
      "stock": 100,
      "description": "苹果最新款手机",
      "images": "[\"image1.jpg\", \"image2.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
      "status": 1,
      "sales": 50,
      "rating": 4.8,
      "createTime": "2023-01-01T12:00:00",
      "updateTime": "2023-01-02T15:30:00"
    },
    {
      "id": 2,
      "name": "华为Mate 50",
      "storeId": 2,
      "categoryId": 3,
      "price": 6999.00,
      "stock": 80,
      "description": "华为旗舰手机",
      "images": "[\"image3.jpg\", \"image4.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"银色\",\"内存\":\"256G\"}",
      "status": 1,
      "sales": 40,
      "rating": 4.9,
      "createTime": "2023-01-03T10:00:00",
      "updateTime": "2023-01-04T14:20:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：获取所有商品
    - 请求：`GET http://localhost:8080/api/products`
    - 预期结果：返回所有商品列表

### 2. 分页获取商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/page`
- 权限：所有用户
- 参数：
    - `pageNum`：页码，默认为1，查询参数
    - `pageSize`：每页大小，默认为10，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "iPhone 13",
        "storeId": 1,
        "categoryId": 3,
        "price": 5999.00,
        "stock": 100,
        "description": "苹果最新款手机",
        "images": "[\"image1.jpg\", \"image2.jpg\"]",
        "detail": "<p>详细描述</p>",
        "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
        "status": 1,
        "sales": 50,
        "rating": 4.8,
        "createTime": "2023-01-01T12:00:00",
        "updateTime": "2023-01-02T15:30:00"
      }
      // 更多商品...
    ],
    "pageNum": 1,
    "pageSize": 10
  }
}
```

#### 测试用例

- **用例1**：获取第一页商品，每页10条
    - 请求：`GET http://localhost:8080/api/products/page?pageNum=1&pageSize=10`
    - 预期结果：返回第一页商品列表，每页10条

- **用例2**：获取第二页商品，每页5条
    - 请求：`GET http://localhost:8080/api/products/page?pageNum=2&pageSize=5`
    - 预期结果：返回第二页商品列表，每页5条

- **用例3**：使用默认分页参数
    - 请求：`GET http://localhost:8080/api/products/page`
    - 预期结果：返回第一页商品列表，每页10条

### 3. 根据ID获取商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/{id}`
- 权限：所有用户
- 参数：
    - `id`：商品ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "name": "iPhone 13",
    "storeId": 1,
    "categoryId": 3,
    "price": 5999.00,
    "stock": 100,
    "description": "苹果最新款手机",
    "images": "[\"image1.jpg\", \"image2.jpg\"]",
    "detail": "<p>详细描述</p>",
    "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
    "status": 1,
    "sales": 50,
    "rating": 4.8,
    "createTime": "2023-01-01T12:00:00",
    "updateTime": "2023-01-02T15:30:00"
  }
}
```

#### 测试用例

- **用例1**：获取存在的商品
    - 请求：`GET http://localhost:8080/api/products/1`
    - 预期结果：返回ID为1的商品信息

- **用例2**：获取不存在的商品
    - 请求：`GET http://localhost:8080/api/products/999`
    - 预期结果：返回错误信息，提示商品不存在

### 4. 根据店铺ID获取商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/store/{storeId}`
- 权限：所有用户
- 参数：
    - `storeId`：店铺ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "iPhone 13",
      "storeId": 1,
      "categoryId": 3,
      "price": 5999.00,
      "stock": 100,
      "description": "苹果最新款手机",
      "images": "[\"image1.jpg\", \"image2.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
      "status": 1,
      "sales": 50,
      "rating": 4.8,
      "createTime": "2023-01-01T12:00:00",
      "updateTime": "2023-01-02T15:30:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：获取特定店铺的商品
    - 请求：`GET http://localhost:8080/api/products/store/1`
    - 预期结果：返回店铺ID为1的所有商品

- **用例2**：获取不存在店铺的商品
    - 请求：`GET http://localhost:8080/api/products/store/999`
    - 预期结果：返回空数组

### 5. 根据分类ID获取商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/category/{categoryId}`
- 权限：所有用户
- 参数：
    - `categoryId`：分类ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "iPhone 13",
      "storeId": 1,
      "categoryId": 3,
      "price": 5999.00,
      "stock": 100,
      "description": "苹果最新款手机",
      "images": "[\"image1.jpg\", \"image2.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
      "status": 1,
      "sales": 50,
      "rating": 4.8,
      "createTime": "2023-01-01T12:00:00",
      "updateTime": "2023-01-02T15:30:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：获取特定分类的商品
    - 请求：`GET http://localhost:8080/api/products/category/3`
    - 预期结果：返回分类ID为3的所有商品

- **用例2**：获取不存在分类的商品
    - 请求：`GET http://localhost:8080/api/products/category/999`
    - 预期结果：返回空数组

### 6. 搜索商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/search`
- 权限：所有用户
- 参数：
    - `keyword`：搜索关键词，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "iPhone 13",
      "storeId": 1,
      "categoryId": 3,
      "price": 5999.00,
      "stock": 100,
      "description": "苹果最新款手机",
      "images": "[\"image1.jpg\", \"image2.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
      "status": 1,
      "sales": 50,
      "rating": 4.8,
      "createTime": "2023-01-01T12:00:00",
      "updateTime": "2023-01-02T15:30:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：使用有效关键词搜索
    - 请求：`GET http://localhost:8080/api/products/search?keyword=iPhone`
    - 预期结果：返回含有"iPhone"关键词的商品列表

- **用例2**：使用无匹配关键词搜索
    - 请求：`GET http://localhost:8080/api/products/search?keyword=不存在的产品`
    - 预期结果：返回空数组

- **用例3**：空关键词搜索
    - 请求：`GET http://localhost:8080/api/products/search?keyword=`
    - 预期结果：返回错误信息，提示搜索关键字不能为空

### 7. 获取热门商品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/hot`
- 权限：所有用户
- 参数：
    - `limit`：数量限制，默认为10，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "iPhone 13",
      "storeId": 1,
      "categoryId": 3,
      "price": 5999.00,
      "stock": 100,
      "description": "苹果最新款手机",
      "images": "[\"image1.jpg\", \"image2.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
      "status": 1,
      "sales": 50,
      "rating": 4.8,
      "createTime": "2023-01-01T12:00:00",
      "updateTime": "2023-01-02T15:30:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：获取默认数量热门商品
    - 请求：`GET http://localhost:8080/api/products/hot`
    - 预期结果：返回10个热门商品（按销量排序）

- **用例2**：获取指定数量热门商品
    - 请求：`GET http://localhost:8080/api/products/hot?limit=5`
    - 预期结果：返回5个热门商品（按销量排序）

### 8. 获取新品

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/products/new`
- 权限：所有用户
- 参数：
    - `limit`：数量限制，默认为10，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 2,
      "name": "华为Mate 50",
      "storeId": 2,
      "categoryId": 3,
      "price": 6999.00,
      "stock": 80,
      "description": "华为旗舰手机",
      "images": "[\"image3.jpg\", \"image4.jpg\"]",
      "detail": "<p>详细描述</p>",
      "specifications": "{\"颜色\":\"银色\",\"内存\":\"256G\"}",
      "status": 1,
      "sales": 40,
      "rating": 4.9,
      "createTime": "2023-01-03T10:00:00",
      "updateTime": "2023-01-04T14:20:00"
    }
    // 更多商品...
  ]
}
```

#### 测试用例

- **用例1**：获取默认数量新品
    - 请求：`GET http://localhost:8080/api/products/new`
    - 预期结果：返回10个新品（按创建时间排序）

- **用例2**：获取指定数量新品
    - 请求：`GET http://localhost:8080/api/products/new?limit=5`
    - 预期结果：返回5个新品（按创建时间排序）

### 9. 添加商品

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/products`
- 权限：商家
- 请求体：

```json
{
  "name": "商品名称",          // 必填，商品名称
  "storeId": 1,              // 必填，所属店铺ID
  "categoryId": 1,           // 必填，商品分类ID
  "price": 999.99,          // 必填，商品价格
  "stock": 100,             // 必填，商品库存
  "description": "商品描述",   // 选填，商品简短描述
  "images": "[\"图片1.jpg\", \"图片2.jpg\"]",  // 选填，商品图片URL数组（JSON格式）
  "detail": "<p>商品详细描述</p>",  // 选填，商品详细介绍（支持HTML）
  "specifications": "{\"颜色\":\"红色\",\"尺寸\":\"XL\"}", // 选填，商品规格（JSON格式）
  "status": 1               // 选填，商品状态（0-下架，1-上架，默认1）
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "添加商品成功",
  "data": {
    "id": 1,                // 商品ID
    "name": "商品名称",
    "storeId": 1,
    "categoryId": 1,
    "price": 999.99,
    "stock": 100,
    "description": "商品描述",
    "images": "[\"图片1.jpg\", \"图片2.jpg\"]",
    "detail": "<p>商品详细描述</p>",
    "specifications": "{\"颜色\":\"红色\",\"尺寸\":\"XL\"}",
    "status": 1,
    "sales": 0,            // 初始销量为0
    "rating": 5.0,         // 初始评分为5.0
    "createTime": "2023-01-10T09:00:00",
    "updateTime": "2023-01-10T09:00:00"
  }
}
```

#### 测试用例

- **用例1**：商家添加商品
    - 请求：`POST http://localhost:8080/api/products`（使用商家token）
      ```json
      {
        "name": "小米12",
        "storeId": 3,
        "categoryId": 3,
        "price": 3999.00,
        "stock": 200,
        "description": "小米最新旗舰",
        "images": "[\"image5.jpg\", \"image6.jpg\"]",
        "detail": "<p>小米12详细描述</p>",
        "specifications": "{\"颜色\":\"蓝色\",\"内存\":\"128G\"}",
        "status": 1
      }
      ```
    - 预期结果：添加成功，返回新添加的商品信息

- **用例2**：添加商品信息不完整
    - 请求：`POST http://localhost:8080/api/products`（使用商家token）
      ```json
      {
        "name": "测试商品",
        "price": 1000.00
      }
      ```
    - 预期结果：添加失败，返回错误信息（缺少必要字段）

- **用例3**：非商家尝试添加商品
    - 请求：`POST http://localhost:8080/api/products`（使用普通用户token）
      ```json
      {
        "name": "测试商品",
        "storeId": 1,
        "categoryId": 3,
        "price": 1000.00,
        "stock": 100
      }
      ```
    - 预期结果：返回403错误，提示无权限

### 10. 更新商品

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/products/{id}`
- 权限：商家
- 参数：
    - `id`：商品ID，路径参数
- 请求体：

```json
{
  "name": "iPhone 13 Pro",
  "price": 7999.00,
  "stock": 50,
  "description": "苹果最新款专业版手机",
  "status": 1
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "更新商品成功",
  "data": {
    "id": 1,
    "name": "iPhone 13 Pro",
    "storeId": 1,
    "categoryId": 3,
    "price": 7999.00,
    "stock": 50,
    "description": "苹果最新款专业版手机",
    "images": "[\"image1.jpg\", \"image2.jpg\"]",
    "detail": "<p>详细描述</p>",
    "specifications": "{\"颜色\":\"黑色\",\"内存\":\"128G\"}",
    "status": 1,
    "sales": 50,
    "rating": 4.8,
    "createTime": "2023-01-01T12:00:00",
    "updateTime": "2023-01-10T11:30:00"
  }
}
```

#### 测试用例

- **用例1**：更新商品名称和价格
    - 请求：`PUT http://localhost:8080/api/products/1`（使用商家token）
      ```json
      {
        "name": "iPhone 13 Pro",
        "price": 7999.00
      }
      ```
    - 预期结果：更新成功，返回更新后的商品信息

- **用例2**：更新商品状态（下架）
    - 请求：`PUT http://localhost:8080/api/products/1`（使用商家token）
      ```json
      {
        "status": 0
      }
      ```
    - 预期结果：更新成功，返回更新后的商品信息（状态为0）

- **用例3**：更新不存在的商品
    - 请求：`PUT http://localhost:8080/api/products/999`（使用商家token）
      ```json
      {
        "name": "测试商品",
        "price": 1000.00
      }
      ```
    - 预期结果：更新失败，返回商品不存在的错误信息

- **用例4**：非商家更新商品
    - 请求：`PUT http://localhost:8080/api/products/1`（使用普通用户token）
      ```json
      {
        "price": 6000.00
      }
      ```
    - 预期结果：返回403错误，提示无权限

### 11. 删除商品

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/products/{id}`
- 权限：商家
- 参数：
    - `id`：商品ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除商品成功",
  "data": true
}
```

#### 测试用例

- **用例1**：商家删除自己的商品
    - 请求：`DELETE http://localhost:8080/api/products/1`（使用商品所属商家token）
    - 预期结果：删除成功，返回true

- **用例2**：删除不存在的商品
    - 请求：`DELETE http://localhost:8080/api/products/999`（使用商家token）
    - 预期结果：删除失败，返回商品不存在的错误信息

- **用例3**：非商家删除商品
    - 请求：`DELETE http://localhost:8080/api/products/1`（使用普通用户token）
    - 预期结果：返回403错误，提示无权限

- **用例4**：商家删除不属于自己的商品
    - 请求：`DELETE http://localhost:8080/api/products/2`（使用其他商家token）
    - 预期结果：返回403错误，提示无权限

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/products`
- 商家账号: merchant/password
- 普通用户账号: user/password
