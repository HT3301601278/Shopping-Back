# 购物车API文档

本文档详细介绍商城系统中与购物车相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取购物车列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/cart`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 10,
      "productId": 101,
      "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
      "quantity": 2,
      "selected": true,
      "createTime": "2023-07-15T10:30:00",
      "product": {
        "id": 101,
        "name": "夏季T恤",
        "price": 99.00,
        "image": "http://example.com/images/tshirt.jpg",
        "stock": 100
        // 更多商品信息...
      },
      "totalPrice": 198.00
    }
    // 更多购物车项...
  ]
}
```

#### 测试用例

- **用例1**：已登录用户获取购物车列表
    - 请求：`GET http://localhost:8080/api/cart`（携带有效token）
    - 预期结果：返回用户的购物车列表

- **用例2**：未登录用户获取购物车列表
    - 请求：`GET http://localhost:8080/api/cart`（无token或无效token）
    - 预期结果：返回未授权错误（401）

### 2. 添加商品到购物车

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/cart`
- 权限：需登录用户
- 请求体：

```json
{
  "productId": 101,
  "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
  "quantity": 2
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "添加购物车成功",
  "data": {
    "id": 1,
    "userId": 10,
    "productId": 101,
    "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
    "quantity": 2,
    "selected": true,
    "createTime": "2023-07-15T10:30:00"
  }
}
```

#### 测试用例

- **用例1**：添加新商品到购物车
    - 请求：`POST http://localhost:8080/api/cart`
      ```json
      {
        "productId": 101,
        "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
        "quantity": 2
      }
      ```
    - 预期结果：添加成功，返回购物车项信息

- **用例2**：添加已有商品到购物车
    - 请求：`POST http://localhost:8080/api/cart`
      ```json
      {
        "productId": 101,
        "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
        "quantity": 1
      }
      ```
    - 预期结果：购物车中该商品数量增加，返回更新后的购物车项

- **用例3**：添加不存在的商品
    - 请求：`POST http://localhost:8080/api/cart`
      ```json
      {
        "productId": 999,
        "quantity": 1
      }
      ```
    - 预期结果：添加失败，返回"商品不存在"错误

- **用例4**：添加库存不足的商品
    - 请求：`POST http://localhost:8080/api/cart`
      ```json
      {
        "productId": 101,
        "quantity": 1000
      }
      ```
    - 预期结果：添加失败，返回"商品库存不足"错误

### 3. 批量添加商品到购物车

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/cart/batch`
- 权限：需登录用户
- 请求体：

```json
[
  {
    "productId": 101,
    "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
    "quantity": 2
  },
  {
    "productId": 102,
    "specInfo": "{\"color\":\"蓝色\",\"size\":\"M\"}",
    "quantity": 1
  }
]
```

#### 响应

```json
{
  "code": 200,
  "msg": "成功添加2件商品到购物车",
  "data": 2
}
```

#### 测试用例

- **用例1**：批量添加多个商品
    - 请求：`POST http://localhost:8080/api/cart/batch`
      ```json
      [
        {
          "productId": 101,
          "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
          "quantity": 2
        },
        {
          "productId": 102,
          "specInfo": "{\"color\":\"蓝色\",\"size\":\"M\"}",
          "quantity": 1
        }
      ]
      ```
    - 预期结果：添加成功，返回添加成功的商品数量

- **用例2**：批量添加包含错误商品
    - 请求：`POST http://localhost:8080/api/cart/batch`
      ```json
      [
        {
          "productId": 101,
          "quantity": 2
        },
        {
          "productId": 999,
          "quantity": 1
        }
      ]
      ```
    - 预期结果：部分添加成功，返回添加成功的商品数量

### 4. 更新购物车商品数量

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/cart/{id}/quantity`
- 权限：需登录用户
- 参数：
    - `id`：购物车项ID，路径参数
    - `quantity`：更新后的数量，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "更新数量成功",
  "data": {
    "id": 1,
    "userId": 10,
    "productId": 101,
    "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
    "quantity": 3,
    "selected": true,
    "createTime": "2023-07-15T10:30:00"
  }
}
```

#### 测试用例

- **用例1**：更新购物车商品数量
    - 请求：`PUT http://localhost:8080/api/cart/1/quantity?quantity=3`
    - 预期结果：更新成功，返回更新后的购物车项

- **用例2**：更新不存在的购物车项
    - 请求：`PUT http://localhost:8080/api/cart/999/quantity?quantity=3`
    - 预期结果：更新失败，返回"购物车商品不存在"错误

- **用例3**：更新数量超过库存
    - 请求：`PUT http://localhost:8080/api/cart/1/quantity?quantity=1000`
    - 预期结果：更新失败，返回"商品库存不足"错误

### 5. 更新购物车商品选择状态

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/cart/{id}/selected`
- 权限：需登录用户
- 参数：
    - `id`：购物车项ID，路径参数
    - `selected`：选择状态，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "更新选择状态成功",
  "data": {
    "id": 1,
    "userId": 10,
    "productId": 101,
    "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
    "quantity": 2,
    "selected": false,
    "createTime": "2023-07-15T10:30:00"
  }
}
```

#### 测试用例

- **用例1**：更新购物车商品选择状态为未选中
    - 请求：`PUT http://localhost:8080/api/cart/1/selected?selected=false`
    - 预期结果：更新成功，返回更新后的购物车项，selected为false

- **用例2**：更新购物车商品选择状态为选中
    - 请求：`PUT http://localhost:8080/api/cart/1/selected?selected=true`
    - 预期结果：更新成功，返回更新后的购物车项，selected为true

- **用例3**：更新不存在的购物车项
    - 请求：`PUT http://localhost:8080/api/cart/999/selected?selected=true`
    - 预期结果：更新失败，返回"购物车商品不存在"错误

### 6. 更新所有购物车商品选择状态

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/cart/selected`
- 权限：需登录用户
- 参数：
    - `selected`：选择状态，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "更新所有选择状态成功",
  "data": true
}
```

#### 测试用例

- **用例1**：全选购物车商品
    - 请求：`PUT http://localhost:8080/api/cart/selected?selected=true`
    - 预期结果：更新成功，返回true

- **用例2**：取消全选购物车商品
    - 请求：`PUT http://localhost:8080/api/cart/selected?selected=false`
    - 预期结果：更新成功，返回true

### 7. 删除购物车商品

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/cart/{id}`
- 权限：需登录用户
- 参数：
    - `id`：购物车项ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除存在的购物车项
    - 请求：`DELETE http://localhost:8080/api/cart/1`
    - 预期结果：删除成功，返回true

- **用例2**：删除不存在的购物车项
    - 请求：`DELETE http://localhost:8080/api/cart/999`
    - 预期结果：删除失败，返回"购物车商品不存在"错误

- **用例3**：删除别人的购物车项
    - 请求：`DELETE http://localhost:8080/api/cart/2`（该项属于其他用户）
    - 预期结果：删除失败，返回"购物车商品不存在"错误（系统会认为该商品对当前用户不存在）

### 8. 清空购物车

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/cart`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "清空成功",
  "data": true
}
```

#### 测试用例

- **用例1**：清空购物车
    - 请求：`DELETE http://localhost:8080/api/cart`
    - 预期结果：清空成功，返回true

- **用例2**：清空空购物车
    - 请求：`DELETE http://localhost:8080/api/cart`（购物车已为空）
    - 预期结果：操作成功，返回true

### 9. 删除已选择的购物车商品

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/cart/selected`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "删除已选择商品成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除已选择的购物车商品
    - 请求：`DELETE http://localhost:8080/api/cart/selected`
    - 预期结果：删除成功，返回true

- **用例2**：删除已选择的购物车商品（无选中项）
    - 请求：`DELETE http://localhost:8080/api/cart/selected`（无选中项）
    - 预期结果：操作成功，返回true

### 10. 获取购物车商品数量

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/cart/count`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": 5
}
```

#### 测试用例

- **用例1**：获取有商品的购物车数量
    - 请求：`GET http://localhost:8080/api/cart/count`
    - 预期结果：返回购物车中商品总数量

- **用例2**：获取空购物车数量
    - 请求：`GET http://localhost:8080/api/cart/count`（购物车为空）
    - 预期结果：返回0

### 11. 获取已选择的购物车商品列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/cart/selected`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 10,
      "productId": 101,
      "specInfo": "{\"color\":\"红色\",\"size\":\"L\"}",
      "quantity": 2,
      "selected": true,
      "createTime": "2023-07-15T10:30:00",
      "product": {
        "id": 101,
        "name": "夏季T恤",
        "price": 99.00,
        "image": "http://example.com/images/tshirt.jpg",
        "stock": 100
        // 更多商品信息...
      },
      "totalPrice": 198.00
    }
    // 更多已选择的购物车项...
  ]
}
```

#### 测试用例

- **用例1**：获取已选择的购物车商品
    - 请求：`GET http://localhost:8080/api/cart/selected`
    - 预期结果：返回已选择的购物车商品列表

- **用例2**：获取已选择的购物车商品（无选中项）
    - 请求：`GET http://localhost:8080/api/cart/selected`（无选中项）
    - 预期结果：返回空数组

### 12. 获取购物车已选择商品的总价

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/cart/amount`
- 权限：需登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "totalAmount": 298.00,
    "itemCount": 2
  }
}
```

#### 测试用例

- **用例1**：获取购物车已选择商品的总价
    - 请求：`GET http://localhost:8080/api/cart/amount`
    - 预期结果：返回已选择商品的总价和商品数量

- **用例2**：获取购物车已选择商品的总价（无选中项）
    - 请求：`GET http://localhost:8080/api/cart/amount`（无选中项）
    - 预期结果：返回总价为0，商品数量为0

### 13. 检查商品是否已在购物车中

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/cart/check`
- 权限：需登录用户
- 参数：
    - `productId`：商品ID，查询参数，必填
    - `specInfo`：规格信息，查询参数（可选）

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": true
}
```

#### 测试用例

- **用例1**：检查已在购物车中的商品
    - 请求：`GET http://localhost:8080/api/cart/check?productId=101&specInfo={"color":"红色","size":"L"}`
    - 预期结果：返回true

- **用例2**：检查不在购物车中的商品
    - 请求：`GET http://localhost:8080/api/cart/check?productId=102`
    - 预期结果：返回false

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/cart`
- 用户登录API: `POST http://localhost:8080/api/auth/login`
    - 请求体:
      ```json
      {
        "username": "user",
        "password": "password"
      }
      ```
    - 响应中的token需在后续请求的Authorization头中使用
