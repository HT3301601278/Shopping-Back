# 分类API文档

本文档详细介绍商城系统中与商品分类相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取所有分类

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/categories`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "电子产品",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 1
    },
    {
      "id": 2,
      "name": "服装",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 2
    }
    // 更多分类...
  ]
}
```

#### 测试用例

- **用例1**：获取所有分类
  - 请求：`GET /api/categories`
  - 预期结果：返回所有分类列表

### 2. 获取树形结构的分类

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/categories/tree`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "电子产品",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 1,
      "children": [
        {
          "id": 3,
          "name": "手机",
          "parentId": 1,
          "level": 2,
          "status": 1,
          "sortOrder": 1
        },
        {
          "id": 4,
          "name": "电脑",
          "parentId": 1,
          "level": 2,
          "status": 1,
          "sortOrder": 2
        }
      ]
    },
    {
      "id": 2,
      "name": "服装",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 2,
      "children": [
        {
          "id": 5,
          "name": "男装",
          "parentId": 2,
          "level": 2,
          "status": 1,
          "sortOrder": 1
        },
        {
          "id": 6,
          "name": "女装",
          "parentId": 2,
          "level": 2,
          "status": 1,
          "sortOrder": 2
        }
      ]
    }
  ]
}
```

#### 测试用例

- **用例1**：获取树形结构的分类
  - 请求：`GET /api/categories/tree`
  - 预期结果：返回树形结构的分类数据

### 3. 根据ID获取分类

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/categories/{id}`
- 权限：所有用户
- 参数：
  - `id`：分类ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "name": "电子产品",
    "parentId": 0,
    "level": 1,
    "status": 1,
    "sortOrder": 1
  }
}
```

#### 测试用例

- **用例1**：获取存在的分类
  - 请求：`GET /api/categories/1`
  - 预期结果：返回ID为1的分类信息

- **用例2**：获取不存在的分类
  - 请求：`GET /api/categories/999`
  - 预期结果：返回错误信息，提示分类不存在

### 4. 获取根分类

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/categories/roots`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "电子产品",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 1
    },
    {
      "id": 2,
      "name": "服装",
      "parentId": 0,
      "level": 1,
      "status": 1,
      "sortOrder": 2
    }
    // 更多根分类...
  ]
}
```

#### 测试用例

- **用例1**：获取所有根分类
  - 请求：`GET /api/categories/roots`
  - 预期结果：返回所有根分类列表

### 5. 获取子分类

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/categories/children/{parentId}`
- 权限：所有用户
- 参数：
  - `parentId`：父分类ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 3,
      "name": "手机",
      "parentId": 1,
      "level": 2,
      "status": 1,
      "sortOrder": 1
    },
    {
      "id": 4,
      "name": "电脑",
      "parentId": 1,
      "level": 2,
      "status": 1,
      "sortOrder": 2
    }
    // 更多子分类...
  ]
}
```

#### 测试用例

- **用例1**：获取特定父分类的子分类
  - 请求：`GET /api/categories/children/1`
  - 预期结果：返回父ID为1的所有子分类

- **用例2**：获取没有子分类的分类
  - 请求：`GET /api/categories/children/5`（假设5是叶子节点）
  - 预期结果：返回空数组

- **用例3**：获取不存在分类的子分类
  - 请求：`GET /api/categories/children/999`
  - 预期结果：返回空数组

### 6. 添加分类

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/categories`
- 权限：仅管理员
- 请求体：

```json
{
  "name": "新分类",
  "parentId": 1,
  "status": 1,
  "sortOrder": 3
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "添加分类成功",
  "data": {
    "id": 7,
    "name": "新分类",
    "parentId": 1,
    "level": 2,
    "status": 1,
    "sortOrder": 3
  }
}
```

#### 测试用例

- **用例1**：管理员添加新分类
  - 请求：`POST /api/categories`
    ```json
    {
      "name": "平板电脑",
      "parentId": 1,
      "status": 1,
      "sortOrder": 3
    }
    ```
  - 预期结果：添加成功，返回新添加的分类信息

- **用例2**：添加重名分类
  - 请求：`POST /api/categories`
    ```json
    {
      "name": "手机",
      "parentId": 1,
      "status": 1
    }
    ```
  - 预期结果：添加失败，返回错误信息（该分类名称已存在）

- **用例3**：非管理员添加分类
  - 请求：`POST /api/categories`（使用普通用户token）
    ```json
    {
      "name": "测试分类",
      "parentId": 0
    }
    ```
  - 预期结果：返回403错误，提示无权限

### 7. 更新分类

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/categories/{id}`
- 权限：仅管理员
- 参数：
  - `id`：分类ID，路径参数
- 请求体：

```json
{
  "name": "更新后的分类名",
  "parentId": 2,
  "status": 1,
  "sortOrder": 5
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "更新分类成功",
  "data": {
    "id": 3,
    "name": "更新后的分类名",
    "parentId": 2,
    "level": 2,
    "status": 1,
    "sortOrder": 5
  }
}
```

#### 测试用例

- **用例1**：更新分类名称
  - 请求：`PUT /api/categories/3`
    ```json
    {
      "name": "智能手机"
    }
    ```
  - 预期结果：更新成功，返回更新后的分类信息

- **用例2**：更新分类的父分类
  - 请求：`PUT /api/categories/3`
    ```json
    {
      "parentId": 2
    }
    ```
  - 预期结果：更新成功，返回更新后的分类信息，level会相应更新

- **用例3**：更新不存在的分类
  - 请求：`PUT /api/categories/999`
    ```json
    {
      "name": "测试分类"
    }
    ```
  - 预期结果：更新失败，返回分类不存在的错误信息

- **用例4**：非管理员更新分类
  - 请求：`PUT /api/categories/1`（使用普通用户token）
    ```json
    {
      "name": "测试分类"
    }
    ```
  - 预期结果：返回403错误，提示无权限

### 8. 删除分类

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/categories/{id}`
- 权限：仅管理员
- 参数：
  - `id`：分类ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除分类成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除叶子节点分类
  - 请求：`DELETE /api/categories/6`（假设6是叶子节点）
  - 预期结果：删除成功，返回true

- **用例2**：删除有子分类的分类
  - 请求：`DELETE /api/categories/1`（假设1有子分类）
  - 预期结果：删除失败，返回错误信息（请先删除子分类）

- **用例3**：删除有关联商品的分类
  - 请求：`DELETE /api/categories/3`（假设3有关联商品）
  - 预期结果：删除失败，返回错误信息（该分类下存在商品，无法删除）

- **用例4**：删除不存在的分类
  - 请求：`DELETE /api/categories/999`
  - 预期结果：删除失败，返回分类不存在的错误信息

- **用例5**：非管理员删除分类
  - 请求：`DELETE /api/categories/5`（使用普通用户token）
  - 预期结果：返回403错误，提示无权限

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/categories`
- 管理员账号: admin/password
- 普通用户账号: user/password
