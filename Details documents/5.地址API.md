# 地址API文档

本文档详细介绍商城系统中与用户地址相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取用户所有地址

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/addresses`
- 权限：仅登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 10,
      "receiverName": "张三",
      "receiverPhone": "13800138000",
      "province": "广东省",
      "city": "深圳市",
      "district": "南山区",
      "detailAddress": "科技园路123号",
      "isDefault": true,
      "createTime": "2023-04-01T10:00:00",
      "updateTime": "2023-04-01T10:00:00"
    },
    {
      "id": 2,
      "userId": 10,
      "receiverName": "李四",
      "receiverPhone": "13900139000",
      "province": "广东省",
      "city": "广州市",
      "district": "天河区",
      "detailAddress": "天河路456号",
      "isDefault": false,
      "createTime": "2023-04-02T14:30:00",
      "updateTime": "2023-04-02T14:30:00"
    }
    // 更多地址...
  ]
}
```

#### 测试用例

- **用例1**：登录用户获取地址列表
  - 请求：`GET /api/addresses`（使用登录用户的token）
  - 预期结果：返回该用户的所有地址列表

- **用例2**：未登录用户获取地址列表
  - 请求：`GET /api/addresses`（未提供有效token）
  - 预期结果：返回401错误，提示未认证

### 2. 获取地址详情

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/addresses/{id}`
- 权限：仅登录用户
- 参数：
  - `id`：地址ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "userId": 10,
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detailAddress": "科技园路123号",
    "isDefault": true,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-01T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：获取存在的自己的地址
  - 请求：`GET /api/addresses/1`（使用地址所有者的token）
  - 预期结果：返回ID为1的地址详情

- **用例2**：获取不存在的地址
  - 请求：`GET /api/addresses/999`
  - 预期结果：返回错误信息，提示地址不存在

- **用例3**：获取他人的地址
  - 请求：`GET /api/addresses/2`（使用非地址所有者的token）
  - 预期结果：返回错误信息，提示地址不存在

### 3. 获取默认地址

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/addresses/default`
- 权限：仅登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "userId": 10,
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detailAddress": "科技园路123号",
    "isDefault": true,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-01T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：获取有默认地址的用户
  - 请求：`GET /api/addresses/default`（使用设置了默认地址的用户token）
  - 预期结果：返回该用户的默认地址信息

- **用例2**：获取没有默认地址的用户
  - 请求：`GET /api/addresses/default`（使用未设置默认地址的用户token）
  - 预期结果：返回null或空对象

### 4. 添加地址

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/addresses`
- 权限：仅登录用户
- 请求体：

```json
{
  "receiverName": "王五",
  "receiverPhone": "13700137000",
  "province": "北京市",
  "city": "北京市",
  "district": "朝阳区",
  "detailAddress": "朝阳路789号",
  "isDefault": false
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "添加地址成功",
  "data": {
    "id": 3,
    "userId": 10,
    "receiverName": "王五",
    "receiverPhone": "13700137000",
    "province": "北京市",
    "city": "北京市",
    "district": "朝阳区",
    "detailAddress": "朝阳路789号",
    "isDefault": false,
    "createTime": "2023-04-03T09:15:00",
    "updateTime": "2023-04-03T09:15:00"
  }
}
```

#### 测试用例

- **用例1**：添加普通地址
  - 请求：`POST /api/addresses`
    ```json
    {
      "receiverName": "王五",
      "receiverPhone": "13700137000",
      "province": "北京市",
      "city": "北京市",
      "district": "朝阳区",
      "detailAddress": "朝阳路789号",
      "isDefault": false
    }
    ```
  - 预期结果：添加成功，返回新添加的地址信息

- **用例2**：添加默认地址
  - 请求：`POST /api/addresses`
    ```json
    {
      "receiverName": "赵六",
      "receiverPhone": "13600136000",
      "province": "上海市",
      "city": "上海市",
      "district": "浦东新区",
      "detailAddress": "张江高科技园区",
      "isDefault": true
    }
    ```
  - 预期结果：添加成功，返回新添加的地址信息，原来的默认地址会变成非默认

- **用例3**：提交无效的手机号
  - 请求：`POST /api/addresses`
    ```json
    {
      "receiverName": "测试",
      "receiverPhone": "12345678",
      "province": "测试省",
      "city": "测试市",
      "district": "测试区",
      "detailAddress": "测试地址"
    }
    ```
  - 预期结果：添加失败，返回错误信息（手机号格式不正确）

### 5. 更新地址

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/addresses/{id}`
- 权限：仅登录用户
- 参数：
  - `id`：地址ID，路径参数
- 请求体：

```json
{
  "receiverName": "张三（修改）",
  "receiverPhone": "13800138001",
  "province": "广东省",
  "city": "深圳市",
  "district": "福田区",
  "detailAddress": "福田路100号",
  "isDefault": true
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "更新地址成功",
  "data": {
    "id": 1,
    "userId": 10,
    "receiverName": "张三（修改）",
    "receiverPhone": "13800138001",
    "province": "广东省",
    "city": "深圳市",
    "district": "福田区",
    "detailAddress": "福田路100号",
    "isDefault": true,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-03T10:30:00"
  }
}
```

#### 测试用例

- **用例1**：更新地址信息
  - 请求：`PUT /api/addresses/1`
    ```json
    {
      "receiverName": "张三（修改）",
      "receiverPhone": "13800138001",
      "province": "广东省",
      "city": "深圳市",
      "district": "福田区",
      "detailAddress": "福田路100号"
    }
    ```
  - 预期结果：更新成功，返回更新后的地址信息

- **用例2**：将非默认地址设为默认
  - 请求：`PUT /api/addresses/2`
    ```json
    {
      "receiverName": "李四",
      "receiverPhone": "13900139000",
      "province": "广东省",
      "city": "广州市",
      "district": "天河区",
      "detailAddress": "天河路456号",
      "isDefault": true
    }
    ```
  - 预期结果：更新成功，返回更新后的地址信息，原来的默认地址会变成非默认

- **用例3**：更新不存在的地址
  - 请求：`PUT /api/addresses/999`
    ```json
    {
      "receiverName": "测试",
      "receiverPhone": "13800138000",
      "province": "测试省",
      "city": "测试市",
      "district": "测试区",
      "detailAddress": "测试地址"
    }
    ```
  - 预期结果：更新失败，返回地址不存在的错误信息

### 6. 删除地址

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/addresses/{id}`
- 权限：仅登录用户
- 参数：
  - `id`：地址ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除地址成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除存在的地址
  - 请求：`DELETE /api/addresses/2`
  - 预期结果：删除成功，返回true

- **用例2**：删除不存在的地址
  - 请求：`DELETE /api/addresses/999`
  - 预期结果：删除失败，返回地址不存在的错误信息

- **用例3**：删除默认地址
  - 请求：`DELETE /api/addresses/1`（假设1是默认地址）
  - 预期结果：删除成功，返回true

### 7. 设置默认地址

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/addresses/{id}/default`
- 权限：仅登录用户
- 参数：
  - `id`：地址ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "设置默认地址成功",
  "data": true
}
```

#### 测试用例

- **用例1**：将非默认地址设为默认
  - 请求：`PUT /api/addresses/2/default`
  - 预期结果：设置成功，返回true，原默认地址会变成非默认

- **用例2**：将已是默认地址的设为默认
  - 请求：`PUT /api/addresses/1/default`（假设1已经是默认地址）
  - 预期结果：设置成功，返回true，状态不变

- **用例3**：设置不存在的地址为默认
  - 请求：`PUT /api/addresses/999/default`
  - 预期结果：设置失败，返回地址不存在的错误信息

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/addresses`
- 测试账号: user/password
