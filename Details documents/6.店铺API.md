# 店铺API文档

本文档详细介绍商城系统中与店铺相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取所有店铺

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 1,
      "name": "电子产品专卖店",
      "logo": "https://example.com/logo1.jpg",
      "description": "销售各类电子产品",
      "contactInfo": "{\"phone\":\"13800138000\",\"email\":\"store@example.com\"}",
      "license": "https://example.com/license1.jpg",
      "status": 1,
      "createTime": "2023-04-01T10:00:00",
      "updateTime": "2023-04-01T10:00:00"
    },
    {
      "id": 2,
      "userId": 2,
      "name": "时尚服装店",
      "logo": "https://example.com/logo2.jpg",
      "description": "提供时尚服装",
      "contactInfo": "{\"phone\":\"13900139000\",\"email\":\"fashion@example.com\"}",
      "license": "https://example.com/license2.jpg",
      "status": 1,
      "createTime": "2023-04-02T10:00:00",
      "updateTime": "2023-04-02T10:00:00"
    }
    // 更多店铺...
  ]
}
```

#### 测试用例

- **用例1**：获取所有店铺
  - 请求：`GET http://localhost:8080/api/stores`
  - 预期结果：返回所有店铺列表

### 2. 分页获取店铺

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/page`
- 权限：所有用户
- 参数：
  - `pageNum`：页码，默认为1（查询参数）
  - `pageSize`：每页大小，默认为10（查询参数）

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "total": 50,
    "list": [
      {
        "id": 1,
        "userId": 1,
        "name": "电子产品专卖店",
        "logo": "https://example.com/logo1.jpg",
        "description": "销售各类电子产品",
        "contactInfo": "{\"phone\":\"13800138000\",\"email\":\"store@example.com\"}",
        "license": "https://example.com/license1.jpg",
        "status": 1,
        "createTime": "2023-04-01T10:00:00",
        "updateTime": "2023-04-01T10:00:00"
      }
      // 更多店铺...
    ],
    "pageNum": 1,
    "pageSize": 10,
    "pages": 5
  }
}
```

#### 测试用例

- **用例1**：默认分页
  - 请求：`GET http://localhost:8080/api/stores/page`
  - 预期结果：返回第1页，每页10条数据

- **用例2**：指定页码和每页大小
  - 请求：`GET http://localhost:8080/api/stores/page?pageNum=2&pageSize=5`
  - 预期结果：返回第2页，每页5条数据

### 3. 根据ID获取店铺

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/{id}`
- 权限：所有用户
- 参数：
  - `id`：店铺ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "userId": 1,
    "name": "电子产品专卖店",
    "logo": "https://example.com/logo1.jpg",
    "description": "销售各类电子产品",
    "contactInfo": "{\"phone\":\"13800138000\",\"email\":\"store@example.com\"}",
    "license": "https://example.com/license1.jpg",
    "status": 1,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-01T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：获取存在的店铺
  - 请求：`GET http://localhost:8080/api/stores/1`
  - 预期结果：返回ID为1的店铺信息

- **用例2**：获取不存在的店铺
  - 请求：`GET http://localhost:8080/api/stores/999`
  - 预期结果：返回错误信息，提示店铺不存在

### 4. 搜索店铺

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/search`
- 权限：所有用户
- 参数：
  - `keyword`：搜索关键字（查询参数）

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 1,
      "name": "电子产品专卖店",
      "logo": "https://example.com/logo1.jpg",
      "description": "销售各类电子产品",
      "contactInfo": "{\"phone\":\"13800138000\",\"email\":\"store@example.com\"}",
      "license": "https://example.com/license1.jpg",
      "status": 1,
      "createTime": "2023-04-01T10:00:00",
      "updateTime": "2023-04-01T10:00:00"
    }
    // 更多匹配的店铺...
  ]
}
```

#### 测试用例

- **用例1**：搜索有结果的关键字
  - 请求：`GET http://localhost:8080/api/stores/search?keyword=电子`
  - 预期结果：返回名称或描述中包含"电子"的店铺列表

- **用例2**：搜索无结果的关键字
  - 请求：`GET http://localhost:8080/api/stores/search?keyword=不存在的关键字`
  - 预期结果：返回空列表

### 5. 创建店铺

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/stores`
- 权限：普通用户（hasRole('USER')）
- 请求体：

```json
{
  "name": "新店铺",
  "logo": "https://example.com/logo_new.jpg",
  "description": "新开的店铺",
  "contactInfo": "{\"phone\":\"13700137000\",\"email\":\"new@example.com\"}",
  "license": "https://example.com/license_new.jpg"
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "店铺创建成功，等待审核",
  "data": {
    "id": 3,
    "userId": 3,
    "name": "新店铺",
    "logo": "https://example.com/logo_new.jpg",
    "description": "新开的店铺",
    "contactInfo": "{\"phone\":\"13700137000\",\"email\":\"new@example.com\"}",
    "license": "https://example.com/license_new.jpg",
    "status": 0,
    "createTime": "2023-04-03T10:00:00",
    "updateTime": "2023-04-03T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：普通用户创建店铺
  - 请求：`POST http://localhost:8080/api/stores`（使用USER角色token）
    ```json
    {
      "name": "测试店铺",
      "logo": "https://example.com/test_logo.jpg",
      "description": "测试用的店铺",
      "contactInfo": "{\"phone\":\"13600136000\"}",
      "license": "https://example.com/test_license.jpg"
    }
    ```
  - 预期结果：创建成功，返回新创建的店铺信息，状态为0（审核中）

- **用例2**：用户重复创建店铺
  - 请求：`POST http://localhost:8080/api/stores`（使用已有店铺的用户token）
    ```json
    {
      "name": "第二个店铺",
      "description": "尝试创建第二个店铺"
    }
    ```
  - 预期结果：创建失败，返回错误信息（用户已有店铺）

- **用例3**：未登录用户创建店铺
  - 请求：`POST http://localhost:8080/api/stores`（无token）
    ```json
    {
      "name": "未登录创建",
      "description": "未登录状态"
    }
    ```
  - 预期结果：返回401错误，提示未认证

- **用例4**：提交不完整信息
  - 请求：`POST http://localhost:8080/api/stores`（使用USER角色token）
    ```json
    {
      "description": "缺少必要的店铺名称"
    }
    ```
  - 预期结果：创建失败，返回400错误，提示缺少必要参数

### 6. 更新店铺信息

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/stores/{id}`
- 权限：店铺所有者（hasRole('MERCHANT')）
- 参数：
  - `id`：店铺ID，路径参数
- 请求体：

```json
{
  "name": "更新后的店铺名称",
  "logo": "https://example.com/updated_logo.jpg",
  "description": "更新后的描述",
  "contactInfo": "{\"phone\":\"13800138001\",\"email\":\"updated@example.com\"}"
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "店铺更新成功",
  "data": {
    "id": 1,
    "userId": 1,
    "name": "更新后的店铺名称",
    "logo": "https://example.com/updated_logo.jpg",
    "description": "更新后的描述",
    "contactInfo": "{\"phone\":\"13800138001\",\"email\":\"updated@example.com\"}",
    "license": "https://example.com/license1.jpg",
    "status": 1,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-03T15:30:00"
  }
}
```

#### 测试用例

- **用例1**：店铺所有者更新自己的店铺
  - 请求：`PUT http://localhost:8080/api/stores/1`（使用ID为1的店铺所有者token）
    ```json
    {
      "name": "新名称",
      "description": "新描述"
    }
    ```
  - 预期结果：更新成功，返回更新后的店铺信息

- **用例2**：非店铺所有者更新店铺
  - 请求：`PUT http://localhost:8080/api/stores/1`（使用非ID为1的店铺所有者token）
    ```json
    {
      "name": "尝试更新他人店铺"
    }
    ```
  - 预期结果：更新失败，返回错误信息（无权操作此店铺）

- **用例3**：更新不存在的店铺
  - 请求：`PUT http://localhost:8080/api/stores/999`（使用MERCHANT角色token）
    ```json
    {
      "name": "不存在的店铺"
    }
    ```
  - 预期结果：更新失败，返回店铺不存在的错误信息

### 7. 删除店铺

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/stores/{id}`
- 权限：管理员（hasRole('ADMIN')）
- 参数：
  - `id`：店铺ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "店铺删除成功",
  "data": true
}
```

#### 测试用例

- **用例1**：管理员删除店铺
  - 请求：`DELETE http://localhost:8080/api/stores/3`（使用ADMIN角色token）
  - 预期结果：删除成功，返回true

- **用例2**：非管理员删除店铺
  - 请求：`DELETE http://localhost:8080/api/stores/3`（使用非ADMIN角色token）
  - 预期结果：返回403错误，提示无权限

- **用例3**：删除不存在的店铺
  - 请求：`DELETE http://localhost:8080/api/stores/999`（使用ADMIN角色token）
  - 预期结果：删除失败，返回店铺不存在的错误信息

- **用例4**：删除有关联商品的店铺
  - 请求：`DELETE http://localhost:8080/api/stores/1`（使用ADMIN角色token，假设店铺1有商品）
  - 预期结果：删除失败，返回错误信息（该店铺下存在商品，无法删除）

### 8. 获取店铺的客服满意度

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/{id}/service-rating`
- 权限：所有用户
- 参数：
  - `id`：店铺ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": 4.8
}
```

#### 测试用例

- **用例1**：获取有客服评分的店铺
  - 请求：`GET http://localhost:8080/api/stores/1/service-rating`
  - 预期结果：返回该店铺的客服满意度评分

- **用例2**：获取无客服评分的店铺
  - 请求：`GET http://localhost:8080/api/stores/2/service-rating`（假设店铺2无评分）
  - 预期结果：返回0或null，表示没有评分

- **用例3**：获取不存在店铺的评分
  - 请求：`GET http://localhost:8080/api/stores/999/service-rating`
  - 预期结果：返回错误信息，提示店铺不存在

### 9. 审核店铺

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/stores/{id}/status`
- 权限：管理员（hasRole('ADMIN')）
- 参数：
  - `id`：店铺ID，路径参数
  - `status`：状态值(0-审核中, 1-正常, 2-关闭)，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "店铺审核通过",
  "data": true
}
```

#### 测试用例

- **用例1**：审核通过店铺
  - 请求：`PUT http://localhost:8080/api/stores/3/status?status=1`（使用ADMIN角色token）
  - 预期结果：更新成功，返回true，消息为"店铺审核通过"

- **用例2**：关闭店铺
  - 请求：`PUT http://localhost:8080/api/stores/2/status?status=2`（使用ADMIN角色token）
  - 预期结果：更新成功，返回true，消息为"店铺已关闭"

- **用例3**：重新设为审核中
  - 请求：`PUT http://localhost:8080/api/stores/1/status?status=0`（使用ADMIN角色token）
  - 预期结果：更新成功，返回true，消息为"店铺状态更新成功"

- **用例4**：非管理员审核店铺
  - 请求：`PUT http://localhost:8080/api/stores/3/status?status=1`（使用非ADMIN角色token）
  - 预期结果：返回403错误，提示无权限

### 10. 获取待审核的店铺列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/pending`
- 权限：管理员（hasRole('ADMIN')）

#### 响应

```json
{
  "code": 200,
  "msg": "获取待审核店铺列表成功",
  "data": [
    {
      "id": 3,
      "userId": 3,
      "name": "新店铺",
      "logo": "https://example.com/logo_new.jpg",
      "description": "新开的店铺",
      "contactInfo": "{\"phone\":\"13700137000\",\"email\":\"new@example.com\"}",
      "license": "https://example.com/license_new.jpg",
      "status": 0,
      "createTime": "2023-04-03T10:00:00",
      "updateTime": "2023-04-03T10:00:00"
    }
    // 更多待审核店铺...
  ]
}
```

#### 测试用例

- **用例1**：管理员获取待审核店铺
  - 请求：`GET http://localhost:8080/api/stores/pending`（使用ADMIN角色token）
  - 预期结果：返回所有状态为0（审核中）的店铺列表

- **用例2**：非管理员获取待审核店铺
  - 请求：`GET http://localhost:8080/api/stores/pending`（使用非ADMIN角色token）
  - 预期结果：返回403错误，提示无权限

### 11. 获取当前登录用户的店铺信息

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/stores/my-store`
- 权限：商家（hasRole('MERCHANT')）

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "userId": 1,
    "name": "电子产品专卖店",
    "logo": "https://example.com/logo1.jpg",
    "description": "销售各类电子产品",
    "contactInfo": "{\"phone\":\"13800138000\",\"email\":\"store@example.com\"}",
    "license": "https://example.com/license1.jpg",
    "status": 1,
    "createTime": "2023-04-01T10:00:00",
    "updateTime": "2023-04-01T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：商家获取自己的店铺
  - 请求：`GET http://localhost:8080/api/stores/my-store`（使用MERCHANT角色token）
  - 预期结果：返回该用户的店铺信息

- **用例2**：无店铺用户获取店铺
  - 请求：`GET http://localhost:8080/api/stores/my-store`（使用无店铺的MERCHANT角色token）
  - 预期结果：返回null或错误信息，提示用户没有店铺

- **用例3**：非商家角色获取店铺
  - 请求：`GET http://localhost:8080/api/stores/my-store`（使用非MERCHANT角色token）
  - 预期结果：返回403错误，提示无权限

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/stores`
- 管理员账号: admin/password
- 商家账号: merchant/password
- 普通用户账号: user/password
