# 公告API文档

本文档详细介绍商城系统中与公告相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取显示中的公告

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements`
- 权限：所有用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "title": "系统维护公告",
      "content": "系统将于本周六凌晨2点进行维护升级，预计停机2小时。",
      "publisherId": 1,
      "status": 1,
      "createTime": "2023-05-01T10:00:00",
      "updateTime": "2023-05-01T10:00:00"
    },
    {
      "id": 2,
      "title": "优惠活动公告",
      "content": "618大促即将开始，全场商品8折起！",
      "publisherId": 1,
      "status": 1,
      "createTime": "2023-05-02T14:30:00",
      "updateTime": "2023-05-02T14:30:00"
    }
    // 更多公告...
  ]
}
```

#### 测试用例

- **用例1**：获取所有显示中的公告
  - 请求：`GET http://localhost:8080/api/announcements`
  - 预期结果：返回所有状态为显示的公告列表

### 2. 获取所有公告（管理员）

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements/admin`
- 权限：仅管理员

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "title": "系统维护公告",
      "content": "系统将于本周六凌晨2点进行维护升级，预计停机2小时。",
      "publisherId": 1,
      "status": 1,
      "readUsers": "[2,3,4]",
      "createTime": "2023-05-01T10:00:00",
      "updateTime": "2023-05-01T10:00:00"
    },
    {
      "id": 2,
      "title": "优惠活动公告",
      "content": "618大促即将开始，全场商品8折起！",
      "publisherId": 1,
      "status": 1,
      "readUsers": "[]",
      "createTime": "2023-05-02T14:30:00",
      "updateTime": "2023-05-02T14:30:00"
    },
    {
      "id": 3,
      "title": "隐藏公告",
      "content": "这是一条隐藏公告，普通用户看不到。",
      "publisherId": 1,
      "status": 0,
      "readUsers": "[]",
      "createTime": "2023-05-03T09:15:00",
      "updateTime": "2023-05-03T09:15:00"
    }
    // 更多公告...
  ]
}
```

#### 测试用例

- **用例1**：管理员获取所有公告
  - 请求：`GET http://localhost:8080/api/announcements/admin`
  - 预期结果：返回所有公告列表，包括显示和隐藏的
  
- **用例2**：非管理员获取所有公告
  - 请求：`GET http://localhost:8080/api/announcements/admin`（使用普通用户token）
  - 预期结果：返回403错误，提示无权限

### 3. 根据ID获取公告详情

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements/{id}`
- 权限：所有用户
- 参数：
  - `id`：公告ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 1,
    "title": "系统维护公告",
    "content": "系统将于本周六凌晨2点进行维护升级，预计停机2小时。",
    "publisherId": 1,
    "status": 1,
    "readUsers": "[2,3,4]",
    "createTime": "2023-05-01T10:00:00",
    "updateTime": "2023-05-01T10:00:00"
  }
}
```

#### 测试用例

- **用例1**：获取存在的公告
  - 请求：`GET http://localhost:8080/api/announcements/1`
  - 预期结果：返回ID为1的公告信息

- **用例2**：获取不存在的公告
  - 请求：`GET http://localhost:8080/api/announcements/999`
  - 预期结果：返回错误信息，提示公告不存在
  
- **用例3**：获取隐藏状态的公告
  - 请求：`GET http://localhost:8080/api/announcements/3`（假设ID为3的公告状态为隐藏）
  - 预期结果：返回ID为3的公告信息（注意，根据控制器实现，隐藏状态的公告也可以通过ID获取）

### 4. 添加公告

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/announcements`
- 权限：仅管理员
- 请求体：

```json
{
  "title": "新公告标题",
  "content": "新公告内容",
  "status": 1
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "添加公告成功",
  "data": {
    "id": 4,
    "title": "新公告标题",
    "content": "新公告内容",
    "publisherId": 1,
    "status": 1,
    "readUsers": "[]",
    "createTime": "2023-05-04T16:45:00",
    "updateTime": "2023-05-04T16:45:00"
  }
}
```

#### 测试用例

- **用例1**：管理员添加新公告
  - 请求：`POST http://localhost:8080/api/announcements`
    ```json
    {
      "title": "新功能上线公告",
      "content": "本系统新增购物车同步功能，欢迎体验！",
      "status": 1
    }
    ```
  - 预期结果：添加成功，返回新添加的公告信息

- **用例2**：添加标题为空的公告
  - 请求：`POST http://localhost:8080/api/announcements`
    ```json
    {
      "title": "",
      "content": "公告内容",
      "status": 1
    }
    ```
  - 预期结果：添加失败，返回错误信息（标题不能为空）

- **用例3**：非管理员添加公告
  - 请求：`POST http://localhost:8080/api/announcements`（使用普通用户token）
    ```json
    {
      "title": "测试公告",
      "content": "测试内容",
      "status": 1
    }
    ```
  - 预期结果：返回403错误，提示无权限

### 5. 更新公告

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/announcements/{id}`
- 权限：仅管理员
- 参数：
  - `id`：公告ID，路径参数
- 请求体：

```json
{
  "title": "更新后的公告标题",
  "content": "更新后的公告内容",
  "status": 0
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "更新公告成功",
  "data": {
    "id": 1,
    "title": "更新后的公告标题",
    "content": "更新后的公告内容",
    "publisherId": 1,
    "status": 0,
    "readUsers": "[2,3,4]",
    "createTime": "2023-05-01T10:00:00",
    "updateTime": "2023-05-05T11:20:00"
  }
}
```

#### 测试用例

- **用例1**：更新公告标题和内容
  - 请求：`PUT http://localhost:8080/api/announcements/1`
    ```json
    {
      "title": "【重要】系统维护时间调整",
      "content": "系统维护时间调整为周日凌晨3点，给您带来不便敬请谅解。",
      "status": 1
    }
    ```
  - 预期结果：更新成功，返回更新后的公告信息

- **用例2**：更新公告状态
  - 请求：`PUT http://localhost:8080/api/announcements/1`
    ```json
    {
      "title": "系统维护公告",
      "content": "系统将于本周六凌晨2点进行维护升级，预计停机2小时。",
      "status": 0
    }
    ```
  - 预期结果：更新成功，返回更新后的公告信息，状态变为隐藏

- **用例3**：更新不存在的公告
  - 请求：`PUT http://localhost:8080/api/announcements/999`
    ```json
    {
      "title": "测试公告",
      "content": "测试内容",
      "status": 1
    }
    ```
  - 预期结果：更新失败，返回公告不存在的错误信息

- **用例4**：非管理员更新公告
  - 请求：`PUT http://localhost:8080/api/announcements/1`（使用普通用户token）
    ```json
    {
      "title": "测试公告",
      "content": "测试内容",
      "status": 1
    }
    ```
  - 预期结果：返回403错误，提示无权限

### 6. 删除公告

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/announcements/{id}`
- 权限：仅管理员
- 参数：
  - `id`：公告ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除公告成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除存在的公告
  - 请求：`DELETE http://localhost:8080/api/announcements/2`
  - 预期结果：删除成功，返回true

- **用例2**：删除不存在的公告
  - 请求：`DELETE http://localhost:8080/api/announcements/999`
  - 预期结果：删除失败，返回公告不存在的错误信息

- **用例3**：非管理员删除公告
  - 请求：`DELETE http://localhost:8080/api/announcements/1`（使用普通用户token）
  - 预期结果：返回403错误，提示无权限

### 7. 更新公告状态

#### 请求

- 方法：`PUT`
- URL：`http://localhost:8080/api/announcements/{id}/status`
- 权限：仅管理员
- 参数：
  - `id`：公告ID，路径参数
  - `status`：状态值(0-隐藏, 1-显示)，查询参数

#### 响应

```json
{
  "code": 200,
  "msg": "更新公告状态成功",
  "data": true
}
```

#### 测试用例

- **用例1**：将公告设为显示状态
  - 请求：`PUT http://localhost:8080/api/announcements/3/status?status=1`
  - 预期结果：更新成功，返回true

- **用例2**：将公告设为隐藏状态
  - 请求：`PUT http://localhost:8080/api/announcements/1/status?status=0`
  - 预期结果：更新成功，返回true

- **用例3**：传入无效的状态值
  - 请求：`PUT http://localhost:8080/api/announcements/1/status?status=2`
  - 预期结果：更新失败，返回错误信息（状态值无效）

- **用例4**：更新不存在公告的状态
  - 请求：`PUT http://localhost:8080/api/announcements/999/status?status=1`
  - 预期结果：更新失败，返回公告不存在的错误信息

- **用例5**：非管理员更新公告状态
  - 请求：`PUT http://localhost:8080/api/announcements/1/status?status=0`（使用普通用户token）
  - 预期结果：返回403错误，提示无权限

### 8. 标记公告为已读

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/announcements/{id}/read`
- 权限：已登录用户
- 参数：
  - `id`：公告ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "标记公告为已读成功",
  "data": true
}
```

#### 测试用例

- **用例1**：标记未读公告为已读
  - 请求：`POST http://localhost:8080/api/announcements/2/read`（假设用户未读该公告）
  - 预期结果：标记成功，返回true

- **用例2**：再次标记已读公告
  - 请求：`POST http://localhost:8080/api/announcements/2/read`（假设已经标记为已读）
  - 预期结果：操作成功，返回true（重复标记不报错）

- **用例3**：标记不存在的公告
  - 请求：`POST http://localhost:8080/api/announcements/999/read`
  - 预期结果：操作失败，返回公告不存在的错误信息

- **用例4**：未登录用户标记公告
  - 请求：`POST http://localhost:8080/api/announcements/2/read`（不带token）
  - 预期结果：返回401错误，提示需要登录

### 9. 获取未读公告数量

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements/unread/count`
- 权限：已登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": 3
}
```

#### 测试用例

- **用例1**：获取当前用户未读公告数量
  - 请求：`GET http://localhost:8080/api/announcements/unread/count`
  - 预期结果：返回当前用户未读公告数量

- **用例2**：未登录用户获取未读公告数量
  - 请求：`GET http://localhost:8080/api/announcements/unread/count`（不带token）
  - 预期结果：返回401错误，提示需要登录

### 10. 获取未读公告列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements/unread`
- 权限：已登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 2,
      "title": "优惠活动公告",
      "content": "618大促即将开始，全场商品8折起！",
      "publisherId": 1,
      "status": 1,
      "createTime": "2023-05-02T14:30:00",
      "updateTime": "2023-05-02T14:30:00"
    },
    {
      "id": 4,
      "title": "新功能上线公告",
      "content": "本系统新增购物车同步功能，欢迎体验！",
      "publisherId": 1,
      "status": 1,
      "createTime": "2023-05-04T16:45:00",
      "updateTime": "2023-05-04T16:45:00"
    }
    // 更多未读公告...
  ]
}
```

#### 测试用例

- **用例1**：获取当前用户未读公告列表
  - 请求：`GET http://localhost:8080/api/announcements/unread`
  - 预期结果：返回当前用户的未读公告列表

- **用例2**：未登录用户获取未读公告列表
  - 请求：`GET http://localhost:8080/api/announcements/unread`（不带token）
  - 预期结果：返回401错误，提示需要登录

### 11. 获取已读公告列表

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/announcements/read`
- 权限：已登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "title": "系统维护公告",
      "content": "系统将于本周六凌晨2点进行维护升级，预计停机2小时。",
      "publisherId": 1,
      "status": 1,
      "createTime": "2023-05-01T10:00:00",
      "updateTime": "2023-05-01T10:00:00"
    }
    // 更多已读公告...
  ]
}
```

#### 测试用例

- **用例1**：获取当前用户已读公告列表
  - 请求：`GET http://localhost:8080/api/announcements/read`
  - 预期结果：返回当前用户的已读公告列表

- **用例2**：未登录用户获取已读公告列表
  - 请求：`GET http://localhost:8080/api/announcements/read`（不带token）
  - 预期结果：返回401错误，提示需要登录

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/announcements`
- 管理员账号: admin/password
- 普通用户账号: user/password
