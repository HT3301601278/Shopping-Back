# 搜索历史API文档

本文档详细介绍商城系统中与搜索历史相关的所有API，包括查询、添加、修改和删除等操作。

### 1. 获取用户搜索历史

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/search-history`
- 权限：已登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 1,
      "userId": 1,
      "keyword": "手机",
      "resultCount": 24,
      "createTime": "2023-08-15T10:30:00"
    },
    {
      "id": 2,
      "userId": 1,
      "keyword": "笔记本电脑",
      "resultCount": 12,
      "createTime": "2023-08-15T14:25:00"
    }
    // 更多搜索历史...
  ]
}
```

#### 测试用例

- **用例1**：获取已登录用户的搜索历史
    - 请求：`GET http://localhost:8080/api/search-history`
    - 预期结果：返回当前登录用户的所有搜索历史列表

- **用例2**：未登录用户访问
    - 请求：`GET http://localhost:8080/api/search-history`（无token或token无效）
    - 预期结果：返回401错误，提示未认证

### 2. 获取最近搜索历史

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/search-history/latest`
- 权限：已登录用户
- 参数：
    - `limit`：返回记录数量，可选，默认为10

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "id": 5,
      "userId": 1,
      "keyword": "智能手表",
      "resultCount": 8,
      "createTime": "2023-08-16T09:45:00"
    },
    {
      "id": 4,
      "userId": 1,
      "keyword": "蓝牙耳机",
      "resultCount": 15,
      "createTime": "2023-08-16T08:20:00"
    }
    // 更多最近搜索历史...
  ]
}
```

#### 测试用例

- **用例1**：获取默认数量的最近搜索历史
    - 请求：`GET http://localhost:8080/api/search-history/latest`
    - 预期结果：返回用户最近的10条搜索历史

- **用例2**：指定返回数量
    - 请求：`GET http://localhost:8080/api/search-history/latest?limit=5`
    - 预期结果：返回用户最近的5条搜索历史

- **用例3**：未登录用户访问
    - 请求：`GET http://localhost:8080/api/search-history/latest`（无token或token无效）
    - 预期结果：返回401错误，提示未认证

### 3. 添加搜索历史

#### 请求

- 方法：`POST`
- URL：`http://localhost:8080/api/search-history`
- 权限：已登录用户
- 请求体：

```json
{
  "keyword": "平板电脑",
  "resultCount": 18
}
```

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": {
    "id": 6,
    "userId": 1,
    "keyword": "平板电脑",
    "resultCount": 18,
    "createTime": "2023-08-16T15:30:00"
  }
}
```

#### 测试用例

- **用例1**：添加新搜索历史
    - 请求：`POST http://localhost:8080/api/search-history`
      ```json
      {
        "keyword": "平板电脑",
        "resultCount": 18
      }
      ```
    - 预期结果：添加成功，返回新添加的搜索历史信息

- **用例2**：添加空关键词
    - 请求：`POST http://localhost:8080/api/search-history`
      ```json
      {
        "keyword": "",
        "resultCount": 0
      }
      ```
    - 预期结果：添加失败，返回400错误，提示"搜索关键词不能为空"

- **用例3**：未登录用户添加
    - 请求：`POST http://localhost:8080/api/search-history`（无token或token无效）
      ```json
      {
        "keyword": "测试",
        "resultCount": 5
      }
      ```
    - 预期结果：返回401错误，提示未认证

### 4. 删除搜索历史

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/search-history/{id}`
- 权限：已登录用户
- 参数：
    - `id`：搜索历史ID，路径参数

#### 响应

```json
{
  "code": 200,
  "msg": "删除搜索历史成功",
  "data": true
}
```

#### 测试用例

- **用例1**：删除自己的搜索历史
    - 请求：`DELETE http://localhost:8080/api/search-history/3`
    - 预期结果：删除成功，返回true

- **用例2**：删除不存在的搜索历史
    - 请求：`DELETE http://localhost:8080/api/search-history/999`
    - 预期结果：删除失败，返回false

- **用例3**：删除其他用户的搜索历史
    - 请求：`DELETE http://localhost:8080/api/search-history/7`（假设ID为7的搜索历史不属于当前用户）
    - 预期结果：删除失败，返回false

- **用例4**：未登录用户删除
    - 请求：`DELETE http://localhost:8080/api/search-history/3`（无token或token无效）
    - 预期结果：返回401错误，提示未认证

### 5. 清空搜索历史

#### 请求

- 方法：`DELETE`
- URL：`http://localhost:8080/api/search-history`
- 权限：已登录用户

#### 响应

```json
{
  "code": 200,
  "msg": "清空搜索历史成功",
  "data": true
}
```

#### 测试用例

- **用例1**：清空所有搜索历史
    - 请求：`DELETE http://localhost:8080/api/search-history`
    - 预期结果：清空成功，返回true

- **用例2**：用户没有搜索历史时清空
    - 请求：`DELETE http://localhost:8080/api/search-history`（假设用户没有搜索历史）
    - 预期结果：返回false，表示没有记录被删除

- **用例3**：未登录用户清空
    - 请求：`DELETE http://localhost:8080/api/search-history`（无token或token无效）
    - 预期结果：返回401错误，提示未认证

### 6. 获取用户热门搜索关键词

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/search-history/hot-keywords`
- 权限：已登录用户
- 参数：
    - `limit`：返回记录数量，可选，默认为10

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "keyword": "手机",
      "count": 5
    },
    {
      "keyword": "电脑",
      "count": 3
    },
    {
      "keyword": "耳机",
      "count": 2
    }
    // 更多热门关键词...
  ]
}
```

#### 测试用例

- **用例1**：获取用户热门关键词
    - 请求：`GET http://localhost:8080/api/search-history/hot-keywords`
    - 预期结果：返回当前用户搜索频率最高的10个关键词

- **用例2**：指定返回数量
    - 请求：`GET http://localhost:8080/api/search-history/hot-keywords?limit=5`
    - 预期结果：返回当前用户搜索频率最高的5个关键词

- **用例3**：用户没有搜索历史
    - 请求：`GET http://localhost:8080/api/search-history/hot-keywords`（假设用户没有搜索历史）
    - 预期结果：返回空数组

- **用例4**：未登录用户访问
    - 请求：`GET http://localhost:8080/api/search-history/hot-keywords`（无token或token无效）
    - 预期结果：返回401错误，提示未认证

### 7. 获取全站热门搜索关键词

#### 请求

- 方法：`GET`
- URL：`http://localhost:8080/api/search-history/global-hot-keywords`
- 权限：公开访问
- 参数：
    - `limit`：返回记录数量，可选，默认为10

#### 响应

```json
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "keyword": "手机",
      "count": 256
    },
    {
      "keyword": "电脑",
      "count": 189
    },
    {
      "keyword": "衣服",
      "count": 145
    }
    // 更多全站热门关键词...
  ]
}
```

#### 测试用例

- **用例1**：获取全站热门关键词
    - 请求：`GET http://localhost:8080/api/search-history/global-hot-keywords`
    - 预期结果：返回全站搜索频率最高的10个关键词

- **用例2**：指定返回数量
    - 请求：`GET http://localhost:8080/api/search-history/global-hot-keywords?limit=5`
    - 预期结果：返回全站搜索频率最高的5个关键词

- **用例3**：未登录用户访问
    - 请求：`GET http://localhost:8080/api/search-history/global-hot-keywords`（无token或token无效）
    - 预期结果：访问成功，返回全站热门关键词

## 错误码说明

- 200: 操作成功
- 400: 请求参数错误
- 401: 未认证或token过期
- 403: 无权操作
- 404: 资源不存在
- 500: 服务器内部错误

## 测试环境

- 测试基础URL: `http://localhost:8080/api/search-history`
- 测试账号: user1/password
- 管理员账号: admin/password
