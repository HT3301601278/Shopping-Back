# 购物系统功能文档

## 1. 用户管理功能

### 1.1 用户注册
- 功能描述：用户通过提供用户名、密码和手机号注册系统账号
- 实现方式：通过AuthController的register接口实现
- 数据要求：用户名和手机号必须唯一，所有字段必须经过验证
- 用户角色：支持普通用户(ROLE_USER)、商家(ROLE_MERCHANT)和管理员(ROLE_ADMIN)三种角色

### 1.2 用户登录
- 功能描述：用户通过用户名和密码登录系统
- 实现方式：通过AuthController的login接口实现
- 返回结果：登录成功返回用户信息和JWT令牌
- 安全性：采用JWT令牌机制确保接口安全

### 1.3 用户信息管理
- 功能描述：用户可查看和修改个人信息，包括头像、密码等
- 实现方式：通过UserController的相关接口实现
- 权限控制：只能查看和修改自己的个人信息
- 具体功能：
  - 获取个人信息：通过GET /api/users/profile接口
  - 更新个人信息：通过PUT /api/users/profile接口
  - 修改密码：通过PUT /api/users/password接口

## 2. 商品管理功能

### 2.1 商品展示
- 功能描述：系统展示所有上架的商品
- 实现方式：通过ProductController的getAllProducts接口实现
- 分页功能：支持分页查询商品，默认每页10条

### 2.2 商品详情
- 功能描述：展示商品的详细信息，包括名称、价格、库存、描述、图片、规格等
- 实现方式：通过ProductController的getProductById接口实现
- 数据内容：包含商品基本信息、规格参数、图片资源和详细描述

### 2.3 商品搜索
- 功能描述：用户可通过关键词搜索商品
- 实现方式：通过ProductController的searchProducts接口实现
- 搜索记录：系统会保存用户的搜索历史

### 2.4 商品分类浏览
- 功能描述：用户可按分类浏览商品
- 实现方式：通过ProductController的getProductsByCategoryId接口实现
- 分类管理：系统支持多级商品分类，通过CategoryController管理

### 2.5 热门商品展示
- 功能描述：展示热门商品，根据销量排序
- 实现方式：通过ProductController的getHotProducts接口实现
- 数据显示：默认显示10个热门商品，可通过limit参数调整

### 2.6 新品展示
- 功能描述：展示新上架商品
- 实现方式：通过ProductController的getNewProducts接口实现
- 数据显示：默认显示10个新品，可通过limit参数调整

### 2.7 商品管理(商家/管理员)
- 功能描述：商家和管理员可添加、修改、删除商品
- 实现方式：通过ProductController的addProduct、updateProduct和deleteProduct接口实现
- 权限控制：只有商家和管理员可执行此操作

## 3. 购物车功能

### 3.1 购物车管理
- 功能描述：用户可添加商品到购物车、修改数量、删除商品
- 实现方式：通过CartController的相关接口实现
- 数据关联：购物车与用户一对一关联

### 3.2 购物车结算
- 功能描述：用户可将购物车中的商品结算生成订单
- 实现方式：通过CartController的结算接口实现
- 库存校验：结算时进行商品库存校验

## 4. 店铺管理功能

### 4.1 店铺信息展示
- 功能描述：展示店铺的基本信息和商品列表
- 实现方式：通过StoreController的相关接口实现
- 数据内容：包含店铺名称、描述、评分等信息

### 4.2 店铺商品展示
- 功能描述：展示店铺的所有商品
- 实现方式：通过ProductController的getProductsByStoreId接口实现
- 过滤条件：只显示上架状态的商品

### 4.3 店铺管理(商家)
- 功能描述：商家可管理自己的店铺信息
- 实现方式：通过StoreController的updateStore接口实现
- 权限控制：只有店铺所有者可执行此操作

### 4.4 店铺审核(管理员)
- 功能描述：管理员负责审核商家创建的店铺
- 实现方式：通过StoreController的auditStore接口实现
- 审核内容：包括店铺基本信息、营业执照等
- 状态变更：可将店铺状态设置为审核中(0)、正常(1)或关闭(2)

### 4.5 店铺服务质量评估
- 功能描述：展示店铺的客服满意度评分
- 实现方式：通过StoreController的getStoreServiceRating接口实现
- 数据来源：基于客户对客服的评价计算得出

## 5. 订单管理功能

### 5.1 订单创建
- 功能描述：用户可创建订单
- 实现方式：通过OrderController的createOrder接口实现
- 数据内容：包含商品信息、数量、金额、收货地址等

### 5.2 订单查询
- 功能描述：用户可查询自己的订单列表和详情
- 实现方式：通过OrderController的相关接口实现
- 状态跟踪：可查看订单的处理状态
- 具体功能：
  - 获取订单列表：通过GET /api/orders接口
  - 获取订单详情：通过GET /api/orders/{id}接口
  - 按状态查询订单：通过GET /api/orders/status/{status}接口
  - 分页查询订单：通过GET /api/orders/page接口

### 5.3 订单管理(商家/管理员)
- 功能描述：商家和管理员可处理订单
- 实现方式：通过OrderController的相关接口实现
- 操作内容：包括发货、取消订单等
- 具体功能：
  - 商家发货：通过POST /api/orders/{id}/ship接口
  - 用户确认收货：通过POST /api/orders/{id}/receive接口
  - 用户取消订单：通过POST /api/orders/{id}/cancel接口

## 6. 地址管理功能

### 6.1 收货地址管理
- 功能描述：用户可添加、修改、删除收货地址
- 实现方式：通过AddressController的相关接口实现
- 数据内容：包含收货人、电话、详细地址等信息

### 6.2 默认地址设置
- 功能描述：用户可设置默认收货地址
- 实现方式：通过AddressController的设置默认地址接口实现
- 使用场景：下单时自动使用默认地址

## 7. 客服系统功能

### 7.1 客服会话管理
- 功能描述：用户可创建客服会话、查看会话列表
- 实现方式：通过CustomerServiceController的相关接口实现
- 会话状态：包括进行中、已关闭等状态
- 具体功能：
  - 创建客服会话：通过POST /api/customer-service/sessions接口
  - 获取用户会话列表：通过GET /api/customer-service/sessions/user接口
  - 获取店铺会话列表：通过GET /api/customer-service/sessions/store/{storeId}接口
  - 结束会话：通过PUT /api/customer-service/sessions/{sessionId}/end接口

### 7.2 客服消息管理
- 功能描述：用户与商家可在会话中互相发送消息
- 实现方式：通过CustomerServiceController的相关接口实现
- 具体功能：
  - 获取会话消息：通过GET /api/customer-service/messages/{sessionId}接口
  - 用户发送消息：通过POST /api/customer-service/messages/{sessionId}/user接口
  - 商家发送消息：通过POST /api/customer-service/messages/{sessionId}/merchant接口
  - 标记消息已读(用户)：通过PUT /api/customer-service/messages/{sessionId}/read/user接口
  - 标记消息已读(商家)：通过PUT /api/customer-service/messages/{sessionId}/read/merchant接口

### 7.3 客服满意度评价
- 功能描述：用户可对客服会话进行满意度评价
- 实现方式：通过CustomerServiceController的evaluateSession接口实现
- 评价内容：包括评分和评价内容
- 统计功能：
  - 获取店铺客服满意度：通过GET /api/customer-service/rating/{storeId}接口
  - 获取客服满意度统计(管理员)：通过GET /api/customer-service/rating/stats接口

### 7.4 投诉处理
- 功能描述：管理员可处理客服投诉
- 实现方式：通过CustomerServiceController的handleComplaint接口实现
- 权限控制：只有管理员可处理投诉

## 8. 评价系统功能

### 8.1 商品评价
- 功能描述：用户可对已购买的商品进行评价
- 实现方式：通过ReviewController的addReview接口实现
- 评价内容：包括评分、评价内容和图片等
- 具体功能：
  - 添加评论：通过POST /api/reviews接口
  - 获取商品评论：通过GET /api/reviews/product/{productId}接口
  - 获取用户评论：通过GET /api/reviews/user/{userId}接口
  - 获取订单评论：通过GET /api/reviews/order/{orderId}接口
  - 获取评论统计：通过GET /api/reviews/product/{productId}/stats接口

### 8.2 评价审核
- 功能描述：管理员审核用户评价，商家可提交审核申请
- 实现方式：通过ReviewController的相关接口实现
- 具体功能：
  - 商家提交审核申请：通过POST /api/reviews/{id}/review-request接口
  - 管理员审核评论：通过PUT /api/reviews/{id}/audit接口
  - 获取待审核评论：通过GET /api/reviews/pending接口

### 8.3 评价管理
- 功能描述：用户和商家可管理评价
- 实现方式：通过ReviewController的相关接口实现
- 具体功能：
  - 评论回复：通过POST /api/reviews/reply接口
  - 获取评论回复：通过GET /api/reviews/{parentId}/replies接口
  - 置顶评论：通过PUT /api/reviews/{id}/top接口
  - 删除评论：通过DELETE /api/reviews/{id}接口

## 9. 公告管理功能

### 9.1 公告展示
- 功能描述：展示系统公告
- 实现方式：通过AnnouncementController的相关接口实现
- 展示方式：支持按时间排序、分页查询

### 9.2 公告管理(管理员)
- 功能描述：管理员可发布、修改、删除公告
- 实现方式：通过AnnouncementController的相关接口实现
- 权限控制：只有管理员可执行此操作

## 10. 搜索历史功能

### 10.1 搜索历史记录
- 功能描述：记录用户的搜索历史
- 实现方式：通过SearchHistoryController的相关接口实现
- 数据内容：包含搜索关键词和时间

### 10.2 历史记录管理
- 功能描述：用户可查看和清空自己的搜索历史
- 实现方式：通过SearchHistoryController的相关接口实现
- 权限控制：只能查看和清空自己的搜索历史

## 11. 系统管理功能(管理员)

### 11.1 用户管理
- 功能描述：管理员可查看、修改、禁用用户账号
- 实现方式：通过AdminController的相关接口实现
- 权限控制：只有管理员可执行此操作

### 11.2 商品审核
- 功能描述：管理员可审核商家上传的商品
- 实现方式：通过AdminController的相关接口实现
- 审核内容：包括商品信息、图片等

### 11.3 统计分析
- 功能描述：管理员可查看系统的统计数据
- 实现方式：通过AdminController的相关接口实现
- 统计内容：包括销售额、用户数、订单数等

## 12. 收藏功能

### 12.1 商品收藏
- 功能描述：用户可收藏感兴趣的商品
- 实现方式：通过FavoriteController的相关接口实现
- 数据关联：与用户和商品关联

### 12.2 收藏管理
- 功能描述：用户可查看和管理自己的收藏
- 实现方式：通过FavoriteController的相关接口实现
- 操作内容：包括查看收藏列表、取消收藏等

## 13. 支付功能

### 13.1 订单支付
- 功能描述：用户可对订单进行支付
- 实现方式：通过PaymentController的pay接口实现
- 数据内容：包含支付方式、支付金额等
- 具体功能：
  - 支付订单：通过POST /api/payment/pay接口
  - 获取支付方式：通过GET /api/payment/methods接口

### 13.2 退款管理
- 功能描述：用户可申请退款，商家和管理员可处理退款申请
- 实现方式：通过PaymentController的相关接口实现
- 具体功能：
  - 申请退款：通过POST /api/payment/refund接口
  - 处理退款：通过POST /api/payment/refund/handle接口

## 14. 文件管理功能

### 14.1 图片上传
- 功能描述：支持上传商品图片、用户头像、店铺logo等
- 实现方式：通过FileController的相关接口实现
- 权限控制：不同角色有不同的上传权限
- 文件类型限制：仅支持JPEG、PNG、GIF、WEBP格式的图片文件
- 具体功能：
  - 上传商品图片：通过POST /api/files/products接口（商家和管理员权限）
  - 上传用户头像：通过POST /api/files/avatars接口（所有用户）
  - 上传店铺logo：通过POST /api/files/stores/logos接口（商家权限）
  - 上传评价图片：通过POST /api/files/reviews接口（普通用户权限）
  - 上传客服消息文件：通过POST /api/files/customer-service接口（登录用户）

### 14.2 文档上传
- 功能描述：支持上传营业执照等文档
- 实现方式：通过FileController的相关接口实现
- 权限控制：只有商家可上传营业执照
- 文件类型限制：仅支持PDF、JPEG、PNG格式的文档
- 具体功能：
  - 上传营业执照：通过POST /api/files/stores/licenses接口（商家权限）

### 14.3 文件删除
- 功能描述：用户可删除自己上传的文件
- 实现方式：通过FileController的deleteFile接口实现
- 权限控制：需要用户登录认证

## 15. 安全机制

### 15.1 身份认证
- 功能描述：使用JWT令牌进行身份认证
- 实现方式：通过SpringSecurity和JWT实现
- 安全保障：保护系统API不被未授权访问

### 15.2 权限控制
- 功能描述：基于角色的权限控制
- 实现方式：通过SpringSecurity的@PreAuthorize注解实现
- 角色区分：区分普通用户、商家和管理员的权限
